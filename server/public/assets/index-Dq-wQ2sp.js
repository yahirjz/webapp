(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();const zo=()=>{};var ii={};const sr={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const f=function(n,e){if(!n)throw Ze(e)},Ze=function(n){return new Error("Firebase Database ("+sr.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};const ir=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let i=n.charCodeAt(s);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},jo=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const i=n[t++];if(i<128)e[s++]=String.fromCharCode(i);else if(i>191&&i<224){const r=n[t++];e[s++]=String.fromCharCode((i&31)<<6|r&63)}else if(i>239&&i<365){const r=n[t++],o=n[t++],a=n[t++],l=((i&7)<<18|(r&63)<<12|(o&63)<<6|a&63)-65536;e[s++]=String.fromCharCode(55296+(l>>10)),e[s++]=String.fromCharCode(56320+(l&1023))}else{const r=n[t++],o=n[t++];e[s++]=String.fromCharCode((i&15)<<12|(r&63)<<6|o&63)}}return e.join("")},fs={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let i=0;i<n.length;i+=3){const r=n[i],o=i+1<n.length,a=o?n[i+1]:0,l=i+2<n.length,c=l?n[i+2]:0,u=r>>2,h=(r&3)<<4|a>>4;let d=(a&15)<<2|c>>6,p=c&63;l||(p=64,o||(d=64)),s.push(t[u],t[h],t[d],t[p])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(ir(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):jo(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let i=0;i<n.length;){const r=t[n.charAt(i++)],a=i<n.length?t[n.charAt(i)]:0;++i;const c=i<n.length?t[n.charAt(i)]:64;++i;const h=i<n.length?t[n.charAt(i)]:64;if(++i,r==null||a==null||c==null||h==null)throw new Go;const d=r<<2|a>>4;if(s.push(d),c!==64){const p=a<<4&240|c>>2;if(s.push(p),h!==64){const _=c<<6&192|h;s.push(_)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Go extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const rr=function(n){const e=ir(n);return fs.encodeByteArray(e,!0)},Ut=function(n){return rr(n).replace(/\./g,"")},Ht=function(n){try{return fs.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function qo(n){return pt(void 0,n)}function pt(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!Qo(t)||(n[t]=pt(n[t],e[t]));return n}function Qo(n){return n!=="__proto__"}function or(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Ko=()=>or().__FIREBASE_DEFAULTS__,Yo=()=>{if(typeof process>"u"||typeof ii>"u")return;const n=ii.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Jo=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Ht(n[1]);return e&&JSON.parse(e)},Xo=()=>{try{return zo()||Ko()||Yo()||Jo()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},ps=()=>Xo()?.config;class H{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}function _s(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Zo(n){return(await fetch(n,{credentials:"include"})).ok}function ea(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",i=n.iat||0,r=n.sub||n.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${s}`,aud:s,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Ut(JSON.stringify(t)),Ut(JSON.stringify(o)),""].join(".")}const ct={};function ta(){const n={prod:[],emulator:[]};for(const e of Object.keys(ct))ct[e]?n.emulator.push(e):n.prod.push(e);return n}function na(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let ri=!1;function sa(n,e){if(typeof window>"u"||typeof document>"u"||!_s(window.location.host)||ct[n]===e||ct[n]||ri)return;ct[n]=e;function t(d){return`__firebase__banner__${d}`}const s="__firebase__banner",r=ta().prod.length>0;function o(){const d=document.getElementById(s);d&&d.remove()}function a(d){d.style.display="flex",d.style.background="#7faaf0",d.style.position="fixed",d.style.bottom="5px",d.style.left="5px",d.style.padding=".5em",d.style.borderRadius="5px",d.style.alignItems="center"}function l(d,p){d.setAttribute("width","24"),d.setAttribute("id",p),d.setAttribute("height","24"),d.setAttribute("viewBox","0 0 24 24"),d.setAttribute("fill","none"),d.style.marginLeft="-6px"}function c(){const d=document.createElement("span");return d.style.cursor="pointer",d.style.marginLeft="16px",d.style.fontSize="24px",d.innerHTML=" &times;",d.onclick=()=>{ri=!0,o()},d}function u(d,p){d.setAttribute("id",p),d.innerText="Learn more",d.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",d.setAttribute("target","__blank"),d.style.paddingLeft="5px",d.style.textDecoration="underline"}function h(){const d=na(s),p=t("text"),_=document.getElementById(p)||document.createElement("span"),C=t("learnmore"),P=document.getElementById(C)||document.createElement("a"),ae=t("preprendIcon"),le=document.getElementById(ae)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(d.created){const xe=d.element;a(xe),u(P,C);const xn=c();l(le,ae),xe.append(le,_,P,xn),document.body.appendChild(xe)}r?(_.innerText="Preview backend disconnected.",le.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(le.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,_.innerText="Preview backend running in this workspace."),_.setAttribute("id",p)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}function ia(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function ar(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ia())}function ra(){return typeof window<"u"||lr()}function lr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function oa(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function aa(){return sr.NODE_ADMIN===!0}function la(){try{return typeof indexedDB=="object"}catch{return!1}}function ca(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(s);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}const ha="FirebaseError";class et extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=ha,Object.setPrototypeOf(this,et.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,rn.prototype.create)}}class rn{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],o=r?ua(r,s):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new et(i,a,s)}}function ua(n,e){return n.replace(da,(t,s)=>{const i=e[s];return i!=null?String(i):`<${s}?>`})}const da=/\{\$([^}]+)}/g;function _t(n){return JSON.parse(n)}function k(n){return JSON.stringify(n)}const cr=function(n){let e={},t={},s={},i="";try{const r=n.split(".");e=_t(Ht(r[0])||""),t=_t(Ht(r[1])||""),i=r[2],s=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:s,signature:i}},fa=function(n){const e=cr(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},pa=function(n){const e=cr(n).claims;return typeof e=="object"&&e.admin===!0};function q(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Oe(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function Vn(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Vt(n,e,t){const s={};for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&(s[i]=e.call(t,n[i],i,n));return s}function $t(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const i of t){if(!s.includes(i))return!1;const r=n[i],o=e[i];if(oi(r)&&oi(o)){if(!$t(r,o))return!1}else if(r!==o)return!1}for(const i of s)if(!t.includes(i))return!1;return!0}function oi(n){return n!==null&&typeof n=="object"}function _a(n){const e=[];for(const[t,s]of Object.entries(n))Array.isArray(s)?s.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}class ma{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const s=this.W_;if(typeof e=="string")for(let h=0;h<16;h++)s[h]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let h=0;h<16;h++)s[h]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let h=16;h<80;h++){const d=s[h-3]^s[h-8]^s[h-14]^s[h-16];s[h]=(d<<1|d>>>31)&4294967295}let i=this.chain_[0],r=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],c,u;for(let h=0;h<80;h++){h<40?h<20?(c=a^r&(o^a),u=1518500249):(c=r^o^a,u=1859775393):h<60?(c=r&o|a&(r|o),u=2400959708):(c=r^o^a,u=3395469782);const d=(i<<5|i>>>27)+c+l+u+s[h]&4294967295;l=a,a=o,o=(r<<30|r>>>2)&4294967295,r=i,i=d}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const s=t-this.blockSize;let i=0;const r=this.buf_;let o=this.inbuf_;for(;i<t;){if(o===0)for(;i<=s;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<t;)if(r[o]=e.charCodeAt(i),++o,++i,o===this.blockSize){this.compress_(r),o=0;break}}else for(;i<t;)if(r[o]=e[i],++o,++i,o===this.blockSize){this.compress_(r),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=t&255,t/=256;this.compress_(this.buf_);let s=0;for(let i=0;i<5;i++)for(let r=24;r>=0;r-=8)e[s]=this.chain_[i]>>r&255,++s;return e}}function ga(n,e){const t=new ya(n,e);return t.subscribe.bind(t)}class ya{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,s){let i;if(e===void 0&&t===void 0&&s===void 0)throw new Error("Missing Observer.");va(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:s},i.next===void 0&&(i.next=An),i.error===void 0&&(i.error=An),i.complete===void 0&&(i.complete=An);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),r}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function va(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function An(){}const g=function(n,e,t,s){let i;if(s<e?i="at least "+e:s>t&&(i=t===0?"none":"no more than "+t),i){const r=n+" failed: Was called with "+s+(s===1?" argument.":" arguments.")+" Expects "+i+".";throw new Error(r)}};function $(n,e){return`${n} failed: ${e} argument `}function O(n,e,t,s){if(!(s&&!t)&&typeof t!="function")throw new Error($(n,e)+"must be a valid function.")}function ai(n,e,t,s){if(t&&(typeof t!="object"||t===null))throw new Error($(n,e)+"must be a valid context object.")}const wa=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let i=n.charCodeAt(s);if(i>=55296&&i<=56319){const r=i-55296;s++,f(s<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(s)-56320;i=65536+(r<<10)+o}i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):i<65536?(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},on=function(n){let e=0;for(let t=0;t<n.length;t++){const s=n.charCodeAt(t);s<128?e++:s<2048?e+=2:s>=55296&&s<=56319?(e+=4,t++):e+=3}return e};function K(n){return n&&n._delegate?n._delegate:n}class de{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Ae="[DEFAULT]";class $n{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new H;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&s.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),s=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(ba(e))try{this.getOrInitializeService({instanceIdentifier:Ae})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const r=this.getOrInitializeService({instanceIdentifier:i});s.resolve(r)}catch{}}}}clearInstance(e=Ae){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ae){return this.instances.has(e)}getOptions(e=Ae){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[r,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(r);s===a&&o.resolve(i)}return i}onInit(e,t){const s=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(s)??new Set;i.add(e),this.onInitCallbacks.set(s,i);const r=this.instances.get(s);return r&&e(r,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const i of s)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:Ca(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=Ae){return this.component?this.component.multipleInstances?e:Ae:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Ca(n){return n===Ae?void 0:n}function ba(n){return n.instantiationMode==="EAGER"}class ms{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new $n(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const gs=[];var S;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(S||(S={}));const hr={debug:S.DEBUG,verbose:S.VERBOSE,info:S.INFO,warn:S.WARN,error:S.ERROR,silent:S.SILENT},Ea=S.INFO,Sa={[S.DEBUG]:"log",[S.VERBOSE]:"log",[S.INFO]:"info",[S.WARN]:"warn",[S.ERROR]:"error"},Ia=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),i=Sa[e];if(i)console[i](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class an{constructor(e){this.name=e,this._logLevel=Ea,this._logHandler=Ia,this._userLogHandler=null,gs.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in S))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?hr[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,S.DEBUG,...e),this._logHandler(this,S.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,S.VERBOSE,...e),this._logHandler(this,S.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,S.INFO,...e),this._logHandler(this,S.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,S.WARN,...e),this._logHandler(this,S.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,S.ERROR,...e),this._logHandler(this,S.ERROR,...e)}}function Ta(n){gs.forEach(e=>{e.setLogLevel(n)})}function Na(n,e){for(const t of gs){let s=null;e&&e.level&&(s=hr[e.level]),n===null?t.userLogHandler=null:t.userLogHandler=(i,r,...o)=>{const a=o.map(l=>{if(l==null)return null;if(typeof l=="string")return l;if(typeof l=="number"||typeof l=="boolean")return l.toString();if(l instanceof Error)return l.message;try{return JSON.stringify(l)}catch{return null}}).filter(l=>l).join(" ");r>=(s??i.logLevel)&&n({level:S[r].toLowerCase(),message:a,args:o,type:i.name})}}}const Ra=(n,e)=>e.some(t=>n instanceof t);let li,ci;function xa(){return li||(li=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Aa(){return ci||(ci=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ur=new WeakMap,zn=new WeakMap,dr=new WeakMap,Pn=new WeakMap,ys=new WeakMap;function Pa(n){const e=new Promise((t,s)=>{const i=()=>{n.removeEventListener("success",r),n.removeEventListener("error",o)},r=()=>{t(ge(n.result)),i()},o=()=>{s(n.error),i()};n.addEventListener("success",r),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&ur.set(t,n)}).catch(()=>{}),ys.set(e,n),e}function ka(n){if(zn.has(n))return;const e=new Promise((t,s)=>{const i=()=>{n.removeEventListener("complete",r),n.removeEventListener("error",o),n.removeEventListener("abort",o)},r=()=>{t(),i()},o=()=>{s(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",r),n.addEventListener("error",o),n.addEventListener("abort",o)});zn.set(n,e)}let jn={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return zn.get(n);if(e==="objectStoreNames")return n.objectStoreNames||dr.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ge(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Da(n){jn=n(jn)}function Oa(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(kn(this),e,...t);return dr.set(s,e.sort?e.sort():[e]),ge(s)}:Aa().includes(n)?function(...e){return n.apply(kn(this),e),ge(ur.get(this))}:function(...e){return ge(n.apply(kn(this),e))}}function Ma(n){return typeof n=="function"?Oa(n):(n instanceof IDBTransaction&&ka(n),Ra(n,xa())?new Proxy(n,jn):n)}function ge(n){if(n instanceof IDBRequest)return Pa(n);if(Pn.has(n))return Pn.get(n);const e=Ma(n);return e!==n&&(Pn.set(n,e),ys.set(e,n)),e}const kn=n=>ys.get(n);function La(n,e,{blocked:t,upgrade:s,blocking:i,terminated:r}={}){const o=indexedDB.open(n,e),a=ge(o);return s&&o.addEventListener("upgradeneeded",l=>{s(ge(o.result),l.oldVersion,l.newVersion,ge(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{r&&l.addEventListener("close",()=>r()),i&&l.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const Fa=["get","getKey","getAll","getAllKeys","count"],Ba=["put","add","delete","clear"],Dn=new Map;function hi(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Dn.get(e))return Dn.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,i=Ba.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(i||Fa.includes(t)))return;const r=async function(o,...a){const l=this.transaction(o,i?"readwrite":"readonly");let c=l.store;return s&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),i&&l.done]))[0]};return Dn.set(e,r),r}Da(n=>({...n,get:(e,t,s)=>hi(e,t)||n.get(e,t,s),has:(e,t)=>!!hi(e,t)||n.has(e,t)}));class Wa{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Ua(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function Ua(n){return n.getComponent()?.type==="VERSION"}const zt="@firebase/app",Gn="0.14.6";const fe=new an("@firebase/app"),Ha="@firebase/app-compat",Va="@firebase/analytics-compat",$a="@firebase/analytics",za="@firebase/app-check-compat",ja="@firebase/app-check",Ga="@firebase/auth",qa="@firebase/auth-compat",Qa="@firebase/database",Ka="@firebase/data-connect",Ya="@firebase/database-compat",Ja="@firebase/functions",Xa="@firebase/functions-compat",Za="@firebase/installations",el="@firebase/installations-compat",tl="@firebase/messaging",nl="@firebase/messaging-compat",sl="@firebase/performance",il="@firebase/performance-compat",rl="@firebase/remote-config",ol="@firebase/remote-config-compat",al="@firebase/storage",ll="@firebase/storage-compat",cl="@firebase/firestore",hl="@firebase/ai",ul="@firebase/firestore-compat",dl="firebase",fl="12.6.0";const Ce="[DEFAULT]",pl={[zt]:"fire-core",[Ha]:"fire-core-compat",[$a]:"fire-analytics",[Va]:"fire-analytics-compat",[ja]:"fire-app-check",[za]:"fire-app-check-compat",[Ga]:"fire-auth",[qa]:"fire-auth-compat",[Qa]:"fire-rtdb",[Ka]:"fire-data-connect",[Ya]:"fire-rtdb-compat",[Ja]:"fire-fn",[Xa]:"fire-fn-compat",[Za]:"fire-iid",[el]:"fire-iid-compat",[tl]:"fire-fcm",[nl]:"fire-fcm-compat",[sl]:"fire-perf",[il]:"fire-perf-compat",[rl]:"fire-rc",[ol]:"fire-rc-compat",[al]:"fire-gcs",[ll]:"fire-gcs-compat",[cl]:"fire-fst",[ul]:"fire-fst-compat",[hl]:"fire-vertex","fire-js":"fire-js",[dl]:"fire-js-all"};const be=new Map,je=new Map,Ge=new Map;function mt(n,e){try{n.container.addComponent(e)}catch(t){fe.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function fr(n,e){n.container.addOrOverwriteComponent(e)}function qe(n){const e=n.name;if(Ge.has(e))return fe.debug(`There were multiple attempts to register component ${e}.`),!1;Ge.set(e,n);for(const t of be.values())mt(t,n);for(const t of je.values())mt(t,n);return!0}function pr(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function _l(n,e,t=Ce){pr(n,e).clearInstance(t)}function vs(n){return n.options!==void 0}function _r(n){return vs(n)?!1:"authIdToken"in n||"appCheckToken"in n||"releaseOnDeref"in n||"automaticDataCollectionEnabled"in n}function mr(n){return n==null?!1:n.settings!==void 0}function ml(){Ge.clear()}const gl={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},G=new rn("app","Firebase",gl);let gr=class{constructor(e,t,s){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new de("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw G.create("app-deleted",{appName:this._name})}};function ui(n,e){const t=Ht(n.split(".")[1]);if(t===null){console.error(`FirebaseServerApp ${e} is invalid: second part could not be parsed.`);return}if(JSON.parse(t).exp===void 0){console.error(`FirebaseServerApp ${e} is invalid: expiration claim could not be parsed`);return}const i=JSON.parse(t).exp*1e3,r=new Date().getTime();i-r<=0&&console.error(`FirebaseServerApp ${e} is invalid: the token has expired.`)}class yl extends gr{constructor(e,t,s,i){const r=t.automaticDataCollectionEnabled!==void 0?t.automaticDataCollectionEnabled:!0,o={name:s,automaticDataCollectionEnabled:r};if(e.apiKey!==void 0)super(e,o,i);else{const a=e;super(a.options,o,i)}this._serverConfig={automaticDataCollectionEnabled:r,...t},this._serverConfig.authIdToken&&ui(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&ui(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,typeof FinalizationRegistry<"u"&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,he(zt,Gn,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,e!==void 0&&this._finalizationRegistry!==null&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){bs(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw G.create("server-app-deleted")}}const ws=fl;function Cs(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s={name:Ce,automaticDataCollectionEnabled:!0,...e},i=s.name;if(typeof i!="string"||!i)throw G.create("bad-app-name",{appName:String(i)});if(t||(t=ps()),!t)throw G.create("no-options");const r=be.get(i);if(r){if($t(t,r.options)&&$t(s,r.config))return r;throw G.create("duplicate-app",{appName:i})}const o=new ms(i);for(const l of Ge.values())o.addComponent(l);const a=new gr(t,s,o);return be.set(i,a),a}function vl(n,e={}){if(ra()&&!lr())throw G.create("invalid-server-app-environment");let t,s=e||{};if(n&&(vs(n)?t=n.options:_r(n)?s=n:t=n),s.automaticDataCollectionEnabled===void 0&&(s.automaticDataCollectionEnabled=!0),t||(t=ps()),!t)throw G.create("no-options");const i={...s,...t};i.releaseOnDeref!==void 0&&delete i.releaseOnDeref;const r=u=>[...u].reduce((h,d)=>Math.imul(31,h)+d.charCodeAt(0)|0,0);if(s.releaseOnDeref!==void 0&&typeof FinalizationRegistry>"u")throw G.create("finalization-registry-not-supported",{});const o=""+r(JSON.stringify(i)),a=je.get(o);if(a)return a.incRefCount(s.releaseOnDeref),a;const l=new ms(o);for(const u of Ge.values())l.addComponent(u);const c=new yl(t,s,o,l);return je.set(o,c),c}function wl(n=Ce){const e=be.get(n);if(!e&&n===Ce&&ps())return Cs();if(!e)throw G.create("no-app",{appName:n});return e}function Cl(){return Array.from(be.values())}async function bs(n){let e=!1;const t=n.name;be.has(t)?(e=!0,be.delete(t)):je.has(t)&&n.decRefCount()<=0&&(je.delete(t),e=!0),e&&(await Promise.all(n.container.getProviders().map(s=>s.delete())),n.isDeleted=!0)}function he(n,e,t){let s=pl[n]??n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),r=e.match(/\s|\//);if(i||r){const o=[`Unable to register library "${s}" with version "${e}":`];i&&o.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&r&&o.push("and"),r&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),fe.warn(o.join(" "));return}qe(new de(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}function yr(n,e){if(n!==null&&typeof n!="function")throw G.create("invalid-log-argument");Na(n,e)}function vr(n){Ta(n)}const bl="firebase-heartbeat-database",El=1,gt="firebase-heartbeat-store";let On=null;function wr(){return On||(On=La(bl,El,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(gt)}catch(t){console.warn(t)}}}}).catch(n=>{throw G.create("idb-open",{originalErrorMessage:n.message})})),On}async function Sl(n){try{const t=(await wr()).transaction(gt),s=await t.objectStore(gt).get(Cr(n));return await t.done,s}catch(e){if(e instanceof et)fe.warn(e.message);else{const t=G.create("idb-get",{originalErrorMessage:e?.message});fe.warn(t.message)}}}async function di(n,e){try{const s=(await wr()).transaction(gt,"readwrite");await s.objectStore(gt).put(e,Cr(n)),await s.done}catch(t){if(t instanceof et)fe.warn(t.message);else{const s=G.create("idb-set",{originalErrorMessage:t?.message});fe.warn(s.message)}}}function Cr(n){return`${n.name}!${n.options.appId}`}const Il=1024,Tl=30;class Nl{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new xl(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=fi();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(i=>i.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:t}),this._heartbeatsCache.heartbeats.length>Tl){const i=Al(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){fe.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=fi(),{heartbeatsToSend:t,unsentEntries:s}=Rl(this._heartbeatsCache.heartbeats),i=Ut(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return fe.warn(e),""}}}function fi(){return new Date().toISOString().substring(0,10)}function Rl(n,e=Il){const t=[];let s=n.slice();for(const i of n){const r=t.find(o=>o.agent===i.agent);if(r){if(r.dates.push(i.date),pi(t)>e){r.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),pi(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class xl{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return la()?ca().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Sl(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return di(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return di(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function pi(n){return Ut(JSON.stringify({version:2,heartbeats:n})).length}function Al(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let s=1;s<n.length;s++)n[s].date<t&&(t=n[s].date,e=s);return e}function Pl(n){qe(new de("platform-logger",e=>new Wa(e),"PRIVATE")),qe(new de("heartbeat",e=>new Nl(e),"PRIVATE")),he(zt,Gn,n),he(zt,Gn,"esm2020"),he("fire-js","")}Pl("");const kl=Object.freeze(Object.defineProperty({__proto__:null,FirebaseError:et,SDK_VERSION:ws,_DEFAULT_ENTRY_NAME:Ce,_addComponent:mt,_addOrOverwriteComponent:fr,_apps:be,_clearComponents:ml,_components:Ge,_getProvider:pr,_isFirebaseApp:vs,_isFirebaseServerApp:mr,_isFirebaseServerAppSettings:_r,_registerComponent:qe,_removeServiceInstance:_l,_serverApps:je,deleteApp:bs,getApp:wl,getApps:Cl,initializeApp:Cs,initializeServerApp:vl,onLog:yr,registerVersion:he,setLogLevel:vr},Symbol.toStringTag,{value:"Module"}));class Dl{constructor(e,t){this._delegate=e,this.firebase=t,mt(e,new de("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),bs(this._delegate)))}_getService(e,t=Ce){this._delegate.checkDestroyed();const s=this._delegate.container.getProvider(e);return!s.isInitialized()&&s.getComponent()?.instantiationMode==="EXPLICIT"&&s.initialize(),s.getImmediate({identifier:t})}_removeServiceInstance(e,t=Ce){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){mt(this._delegate,e)}_addOrOverwriteComponent(e){fr(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const Ol={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."},_i=new rn("app-compat","Firebase",Ol);function Ml(n){const e={},t={__esModule:!0,initializeApp:r,app:i,registerVersion:he,setLogLevel:vr,onLog:yr,apps:null,SDK_VERSION:ws,INTERNAL:{registerComponent:a,removeApp:s,useAsService:l,modularAPIs:kl}};t.default=t,Object.defineProperty(t,"apps",{get:o});function s(c){delete e[c]}function i(c){if(c=c||Ce,!q(e,c))throw _i.create("no-app",{appName:c});return e[c]}i.App=n;function r(c,u={}){const h=Cs(c,u);if(q(e,h.name))return e[h.name];const d=new n(h,t);return e[h.name]=d,d}function o(){return Object.keys(e).map(c=>e[c])}function a(c){const u=c.name,h=u.replace("-compat","");if(qe(c)&&c.type==="PUBLIC"){const d=(p=i())=>{if(typeof p[h]!="function")throw _i.create("invalid-app-argument",{appName:u});return p[h]()};c.serviceProps!==void 0&&pt(d,c.serviceProps),t[h]=d,n.prototype[h]=function(...p){return this._getService.bind(this,u).apply(this,c.multipleInstances?p:[])}}return c.type==="PUBLIC"?t[h]:null}function l(c,u){return u==="serverAuth"?null:u}return t}function br(){const n=Ml(Dl);n.INTERNAL={...n.INTERNAL,createFirebaseNamespace:br,extendNamespace:e,createSubscribe:ga,ErrorFactory:rn,deepExtend:pt};function e(t){pt(n,t)}return n}const Ll=br();const mi=new an("@firebase/app-compat"),Fl="@firebase/app-compat",Bl="0.5.6";function Wl(n){he(Fl,Bl,n)}try{const n=or();if(n.firebase!==void 0){mi.warn(`
      Warning: Firebase is already defined in the global scope. Please make sure
      Firebase library is only loaded once.
    `);const e=n.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&mi.warn(`
        Warning: You are trying to load Firebase while using Firebase Performance standalone script.
        You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
        `)}}catch{}const ln=Ll;Wl();var Ul="firebase",Hl="12.6.0";ln.registerVersion(Ul,Hl,"app-compat");var gi={};const yi="@firebase/database",vi="1.1.0";let Er="";function Sr(n){Er=n}class Vl{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),k(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:_t(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class $l{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return q(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const Ir=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Vl(e)}}catch{}return new $l},ke=Ir("localStorage"),qn=Ir("sessionStorage");const $e=new an("@firebase/database"),Tr=(function(){let n=1;return function(){return n++}})(),Nr=function(n){const e=wa(n),t=new ma;t.update(e);const s=t.digest();return fs.encodeByteArray(s)},Nt=function(...n){let e="";for(let t=0;t<n.length;t++){const s=n[t];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=Nt.apply(null,s):typeof s=="object"?e+=k(s):e+=s,e+=" "}return e};let De=null,wi=!0;const Rr=function(n,e){f(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?($e.logLevel=S.VERBOSE,De=$e.log.bind($e),e&&qn.set("logging_enabled",!0)):typeof n=="function"?De=n:(De=null,qn.remove("logging_enabled"))},L=function(...n){if(wi===!0&&(wi=!1,De===null&&qn.get("logging_enabled")===!0&&Rr(!0)),De){const e=Nt.apply(null,n);De(e)}},Rt=function(n){return function(...e){L(n,...e)}},Qn=function(...n){const e="FIREBASE INTERNAL ERROR: "+Nt(...n);$e.error(e)},re=function(...n){const e=`FIREBASE FATAL ERROR: ${Nt(...n)}`;throw $e.error(e),new Error(e)},W=function(...n){const e="FIREBASE WARNING: "+Nt(...n);$e.warn(e)},zl=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&W("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},cn=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},jl=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Ee="[MIN_NAME]",pe="[MAX_NAME]",Be=function(n,e){if(n===e)return 0;if(n===Ee||e===pe)return-1;if(e===Ee||n===pe)return 1;{const t=Ci(n),s=Ci(e);return t!==null?s!==null?t-s===0?n.length-e.length:t-s:-1:s!==null?1:n<e?-1:1}},Gl=function(n,e){return n===e?0:n<e?-1:1},rt=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+k(e))},Es=function(n){if(typeof n!="object"||n===null)return k(n);const e=[];for(const s in n)e.push(s);e.sort();let t="{";for(let s=0;s<e.length;s++)s!==0&&(t+=","),t+=k(e[s]),t+=":",t+=Es(n[e[s]]);return t+="}",t},xr=function(n,e){const t=n.length;if(t<=e)return[n];const s=[];for(let i=0;i<t;i+=e)i+e>t?s.push(n.substring(i,t)):s.push(n.substring(i,i+e));return s};function F(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const Ar=function(n){f(!cn(n),"Invalid JSON number");const e=11,t=52,s=(1<<e-1)-1;let i,r,o,a,l;n===0?(r=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-s)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),s),r=a+s,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(r=0,o=Math.round(n/Math.pow(2,1-s-t))));const c=[];for(l=t;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(i?1:0),c.reverse();const u=c.join("");let h="";for(l=0;l<64;l+=8){let d=parseInt(u.substr(l,8),2).toString(16);d.length===1&&(d="0"+d),h=h+d}return h.toLowerCase()},ql=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Ql=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Kl(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const s=new Error(n+" at "+e._path.toString()+": "+t);return s.code=n.toUpperCase(),s}const Yl=new RegExp("^-?(0*)\\d{1,10}$"),Jl=-2147483648,Xl=2147483647,Ci=function(n){if(Yl.test(n)){const e=Number(n);if(e>=Jl&&e<=Xl)return e}return null},tt=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw W("Exception was thrown by user callback.",t),e},Math.floor(0))}},Zl=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},ht=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};class ec{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,mr(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(s=>this.appCheck=s)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){W(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class tc{constructor(e,t,s){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(L("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',W(e)}}class ze{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}ze.OWNER="owner";const Ss="5",Pr="v",kr="s",Dr="r",Or="f",Mr=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Lr="ls",Fr="p",Kn="ac",Br="websocket",Wr="long_polling";class Ur{constructor(e,t,s,i,r=!1,o="",a=!1,l=!1,c=null){this.secure=t,this.namespace=s,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ke.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ke.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function nc(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function Hr(n,e,t){f(typeof e=="string","typeof type must == string"),f(typeof t=="object","typeof params must == object");let s;if(e===Br)s=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===Wr)s=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);nc(n)&&(t.ns=n.namespace);const i=[];return F(t,(r,o)=>{i.push(r+"="+o)}),s+i.join("&")}class sc{constructor(){this.counters_={}}incrementCounter(e,t=1){q(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return qo(this.counters_)}}const Mn={},Ln={};function Is(n){const e=n.toString();return Mn[e]||(Mn[e]=new sc),Mn[e]}function ic(n,e){const t=n.toString();return Ln[t]||(Ln[t]=e()),Ln[t]}class rc{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<s.length;++i)s[i]&&tt(()=>{this.onMessage_(s[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const bi="start",oc="close",ac="pLPCommand",lc="pRTLPCB",Vr="id",$r="pw",zr="ser",cc="cb",hc="seg",uc="ts",dc="d",fc="dframe",jr=1870,Gr=30,pc=jr-Gr,_c=25e3,mc=3e4;class _e{constructor(e,t,s,i,r,o,a){this.connId=e,this.repoInfo=t,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Rt(e),this.stats_=Is(t),this.urlFn=l=>(this.appCheckToken&&(l[Kn]=this.appCheckToken),Hr(t,Wr,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new rc(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(mc)),jl(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Ts((...r)=>{const[o,a,l,c,u]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===bi)this.id=a,this.password=l;else if(o===oc)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{const[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const s={};s[bi]="t",s[zr]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[cc]=this.scriptTagHolder.uniqueCallbackIdentifier),s[Pr]=Ss,this.transportSessionId&&(s[kr]=this.transportSessionId),this.lastSessionId&&(s[Lr]=this.lastSessionId),this.applicationId&&(s[Fr]=this.applicationId),this.appCheckToken&&(s[Kn]=this.appCheckToken),typeof location<"u"&&location.hostname&&Mr.test(location.hostname)&&(s[Dr]=Or);const i=this.urlFn(s);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){_e.forceAllow_=!0}static forceDisallow(){_e.forceDisallow_=!0}static isAvailable(){return _e.forceAllow_?!0:!_e.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!ql()&&!Ql()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=k(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=rr(t),i=xr(s,pc);for(let r=0;r<i.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const s={};s[fc]="t",s[Vr]=e,s[$r]=t,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=k(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Ts{constructor(e,t,s,i){this.onDisconnect=s,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Tr(),window[ac+this.uniqueCallbackIdentifier]=e,window[lc+this.uniqueCallbackIdentifier]=t,this.myIFrame=Ts.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){L("frame writing exception"),a.stack&&L(a.stack),L(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||L("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[Vr]=this.myID,e[$r]=this.myPW,e[zr]=this.currentSerial;let t=this.urlFn(e),s="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Gr+s.length<=jr;){const o=this.pendingSegs.shift();s=s+"&"+hc+i+"="+o.seg+"&"+uc+i+"="+o.ts+"&"+dc+i+"="+o.d,i++}return t=t+s,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,s){this.pendingSegs.push({seg:e,ts:t,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const s=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(s,Math.floor(_c)),r=()=>{clearTimeout(i),s()};this.addTag(e,r)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const i=s.readyState;(!i||i==="loaded"||i==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),t())},s.onerror=()=>{L("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}const gc=16384,yc=45e3;let jt=null;typeof MozWebSocket<"u"?jt=MozWebSocket:typeof WebSocket<"u"&&(jt=WebSocket);class Y{constructor(e,t,s,i,r,o,a){this.connId=e,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Rt(this.connId),this.stats_=Is(t),this.connURL=Y.connectionURL_(t,o,a,i,s),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,s,i,r){const o={};return o[Pr]=Ss,typeof location<"u"&&location.hostname&&Mr.test(location.hostname)&&(o[Dr]=Or),t&&(o[kr]=t),s&&(o[Lr]=s),i&&(o[Kn]=i),r&&(o[Fr]=r),Hr(e,Br,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ke.set("previous_websocket_failure",!0);try{let s;aa(),this.mySock=new jt(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const i=s.message||s.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const i=s.message||s.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){Y.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(t);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&jt!==null&&!Y.forceDisallow_}static previouslyFailed(){return ke.isInMemoryStorage||ke.get("previous_websocket_failure")===!0}markConnectionHealthy(){ke.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const s=_t(t);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(f(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const s=this.extractFrameCount_(t);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const t=k(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=xr(t,gc);s.length>1&&this.sendString_(String(s.length));for(let i=0;i<s.length;i++)this.sendString_(s[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(yc))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Y.responsesRequiredToBeHealthy=2;Y.healthyTimeout=3e4;class Qe{static get ALL_TRANSPORTS(){return[_e,Y]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=Y&&Y.isAvailable();let s=t&&!Y.previouslyFailed();if(e.webSocketOnly&&(t||W("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Y];else{const i=this.transports_=[];for(const r of Qe.ALL_TRANSPORTS)r&&r.isAvailable()&&i.push(r);Qe.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Qe.globalTransportInitialized_=!1;const vc=6e4,wc=5e3,Cc=10*1024,bc=100*1024,Fn="t",Ei="d",Ec="s",Si="r",Sc="e",Ii="o",Ti="a",Ni="n",Ri="p",Ic="h";class Tc{constructor(e,t,s,i,r,o,a,l,c,u){this.id=e,this.repoInfo_=t,this.applicationId_=s,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Rt("c:"+this.id+":"),this.transportManager_=new Qe(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,s)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=ht(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>bc?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Cc?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Fn in e){const t=e[Fn];t===Ti?this.upgradeIfSecondaryHealthy_():t===Si?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Ii&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=rt("t",e),s=rt("d",e);if(t==="c")this.onSecondaryControl_(s);else if(t==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Ri,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Ti,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Ni,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=rt("t",e),s=rt("d",e);t==="c"?this.onControl_(s):t==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=rt(Fn,e);if(Ei in e){const s=e[Ei];if(t===Ic){const i={...s};this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===Ni){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===Ec?this.onConnectionShutdown_(s):t===Si?this.onReset_(s):t===Sc?Qn("Server Error: "+s):t===Ii?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Qn("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,s=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Ss!==s&&W("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,s),ht(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(vc))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ht(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(wc))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Ri,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ke.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class qr{put(e,t,s,i){}merge(e,t,s,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,s){}onDisconnectMerge(e,t,s){}onDisconnectCancel(e,t){}reportStats(e){}}class Qr{constructor(e){this.allowedEvents_=e,this.listeners_={},f(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let i=0;i<s.length;i++)s[i].callback.apply(s[i].context,t)}}on(e,t,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:s});const i=this.getInitialEvent(e);i&&t.apply(s,i)}off(e,t,s){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let r=0;r<i.length;r++)if(i[r].callback===t&&(!s||s===i[r].context)){i.splice(r,1);return}}validateEventType_(e){f(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class Gt extends Qr{static getInstance(){return new Gt}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!ar()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return f(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const xi=32,Ai=768;class E{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let s=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[s]=this.pieces_[i],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function b(){return new E("")}function y(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Se(n){return n.pieces_.length-n.pieceNum_}function I(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new E(n.pieces_,e)}function Ns(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function Nc(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function yt(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function Kr(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new E(e,0)}function R(n,e){const t=[];for(let s=n.pieceNum_;s<n.pieces_.length;s++)t.push(n.pieces_[s]);if(e instanceof E)for(let s=e.pieceNum_;s<e.pieces_.length;s++)t.push(e.pieces_[s]);else{const s=e.split("/");for(let i=0;i<s.length;i++)s[i].length>0&&t.push(s[i])}return new E(t,0)}function v(n){return n.pieceNum_>=n.pieces_.length}function U(n,e){const t=y(n),s=y(e);if(t===null)return e;if(t===s)return U(I(n),I(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function Rc(n,e){const t=yt(n,0),s=yt(e,0);for(let i=0;i<t.length&&i<s.length;i++){const r=Be(t[i],s[i]);if(r!==0)return r}return t.length===s.length?0:t.length<s.length?-1:1}function Rs(n,e){if(Se(n)!==Se(e))return!1;for(let t=n.pieceNum_,s=e.pieceNum_;t<=n.pieces_.length;t++,s++)if(n.pieces_[t]!==e.pieces_[s])return!1;return!0}function J(n,e){let t=n.pieceNum_,s=e.pieceNum_;if(Se(n)>Se(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[s])return!1;++t,++s}return!0}class xc{constructor(e,t){this.errorPrefix_=t,this.parts_=yt(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=on(this.parts_[s]);Yr(this)}}function Ac(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=on(e),Yr(n)}function Pc(n){const e=n.parts_.pop();n.byteLength_-=on(e),n.parts_.length>0&&(n.byteLength_-=1)}function Yr(n){if(n.byteLength_>Ai)throw new Error(n.errorPrefix_+"has a key path longer than "+Ai+" bytes ("+n.byteLength_+").");if(n.parts_.length>xi)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+xi+") or object contains a cycle "+Pe(n))}function Pe(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}class xs extends Qr{static getInstance(){return new xs}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}getInitialEvent(e){return f(e==="visible","Unknown event type: "+e),[this.visible_]}}const ot=1e3,kc=300*1e3,Pi=30*1e3,Dc=1.3,Oc=3e4,Mc="server_kill",ki=3;class ue extends qr{constructor(e,t,s,i,r,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=s,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=ue.nextPersistentConnectionId_++,this.log_=Rt("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=ot,this.maxReconnectDelay_=kc,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");xs.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Gt.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,s){const i=++this.requestNumber_,r={r:i,a:e,b:t};this.log_(k(r)),f(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),s&&(this.requestCBHash_[i]=s)}get(e){this.initConnection_();const t=new H,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,s,i){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),f(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),f(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const a={onComplete:i,hashFn:t,query:e,tag:s};this.listens.get(o).set(r,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(s)})}sendListen_(e){const t=e.query,s=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+s+" for "+i);const r={p:s},o="q";e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest(o,r,a=>{const l=a.d,c=a.s;ue.warnOnListenWarnings_(l,t),(this.listens.get(s)&&this.listens.get(s).get(i))===e&&(this.log_("listen response",a),c!=="ok"&&this.removeListen_(s,i),e.onComplete&&e.onComplete(c,l))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&q(e,"w")){const s=Oe(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const i='".indexOn": "'+t._queryParams.getIndex().toString()+'"',r=t._path.toString();W(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||pa(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Pi)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=fa(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(t,s,i=>{const r=i.s,o=i.d||"error";this.authToken_===e&&(r==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,s=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,s)})}unlisten(e,t){const s=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+i),f(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,i)&&this.connected_&&this.sendUnlisten_(s,i,e._queryObject,t)}sendUnlisten_(e,t,s,i){this.log_("Unlisten on "+e+" for "+t);const r={p:e},o="n";i&&(r.q=s,r.t=i),this.sendRequest(o,r)}onDisconnectPut(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:s})}onDisconnectMerge(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:s})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,s,i){const r={p:t,d:s};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,o=>{i&&setTimeout(()=>{i(o.s,o.d)},Math.floor(0))})}put(e,t,s,i){this.putInternal("p",e,t,s,i)}merge(e,t,s,i){this.putInternal("m",e,t,s,i)}putInternal(e,t,s,i,r){this.initConnection_();const o={p:t,d:s};r!==void 0&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:i}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,s,r=>{this.log_(t+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(r.s,r.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,s=>{if(s.s!=="ok"){const r=s.d;this.log_("reportStats","Error sending stats: "+r)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+k(e));const t=e.r,s=this.requestCBHash_[t];s&&(delete this.requestCBHash_[t],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):Qn("Unrecognized action received from server: "+k(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){f(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=ot,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=ot,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Oc&&(this.reconnectDelay_=ot),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Dc)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+ue.nextConnectionId_++,r=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,s())},c=function(h){f(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(h)};this.realtime_={close:l,sendRequest:c};const u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,d]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);o?L("getToken() completed but was canceled"):(L("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=d&&d.token,a=new Tc(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,s,p=>{W(p+" ("+this.repoInfo_.toString()+")"),this.interrupt(Mc)},r))}catch(h){this.log_("Failed to get token: "+h),o||(this.repoInfo_.nodeAdmin&&W(h),l())}}}interrupt(e){L("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){L("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Vn(this.interruptReasons_)&&(this.reconnectDelay_=ot,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let s;t?s=t.map(r=>Es(r)).join("$"):s="default";const i=this.removeListen_(e,s);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const s=new E(e).toString();let i;if(this.listens.has(s)){const r=this.listens.get(s);i=r.get(t),r.delete(t),r.size===0&&this.listens.delete(s)}else i=void 0;return i}onAuthRevoked_(e,t){L("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=ki&&(this.reconnectDelay_=Pi,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){L("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=ki&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+Er.replace(/\./g,"-")]=1,ar()?e["framework.cordova"]=1:oa()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Gt.getInstance().currentlyOnline();return Vn(this.interruptReasons_)&&e}}ue.nextPersistentConnectionId_=0;ue.nextConnectionId_=0;class w{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new w(e,t)}}class hn{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const s=new w(Ee,e),i=new w(Ee,t);return this.compare(s,i)!==0}minPost(){return w.MIN}}let Ft;class Jr extends hn{static get __EMPTY_NODE(){return Ft}static set __EMPTY_NODE(e){Ft=e}compare(e,t){return Be(e.name,t.name)}isDefinedOn(e){throw Ze("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return w.MIN}maxPost(){return new w(pe,Ft)}makePost(e,t){return f(typeof e=="string","KeyIndex indexValue must always be a string."),new w(e,Ft)}toString(){return".key"}}const ie=new Jr;class Bt{constructor(e,t,s,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?s(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class M{constructor(e,t,s,i,r){this.key=e,this.value=t,this.color=s??M.RED,this.left=i??V.EMPTY_NODE,this.right=r??V.EMPTY_NODE}copy(e,t,s,i,r){return new M(e??this.key,t??this.value,s??this.color,i??this.left,r??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let i=this;const r=s(e,i.key);return r<0?i=i.copy(null,null,null,i.left.insert(e,t,s),null):r===0?i=i.copy(null,t,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,t,s)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return V.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let s,i;if(s=this,t(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),t(e,s.key)===0){if(s.right.isEmpty())return V.EMPTY_NODE;i=s.right.min_(),s=s.copy(i.key,i.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,M.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,M.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}M.RED=!0;M.BLACK=!1;class Lc{copy(e,t,s,i,r){return this}insert(e,t,s){return new M(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class V{constructor(e,t=V.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new V(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,M.BLACK,null,null))}remove(e){return new V(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,M.BLACK,null,null))}get(e){let t,s=this.root_;for(;!s.isEmpty();){if(t=this.comparator_(e,s.key),t===0)return s.value;t<0?s=s.left:t>0&&(s=s.right)}return null}getPredecessorKey(e){let t,s=this.root_,i=null;for(;!s.isEmpty();)if(t=this.comparator_(e,s.key),t===0){if(s.left.isEmpty())return i?i.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else t<0?s=s.left:t>0&&(i=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Bt(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Bt(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Bt(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Bt(this.root_,null,this.comparator_,!0,e)}}V.EMPTY_NODE=new Lc;function Fc(n,e){return Be(n.name,e.name)}function As(n,e){return Be(n,e)}let Yn;function Bc(n){Yn=n}const Xr=function(n){return typeof n=="number"?"number:"+Ar(n):"string:"+n},Zr=function(n){if(n.isLeafNode()){const e=n.val();f(typeof e=="string"||typeof e=="number"||typeof e=="object"&&q(e,".sv"),"Priority must be a string or number.")}else f(n===Yn||n.isEmpty(),"priority of unexpected type.");f(n===Yn||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Di;class D{static set __childrenNodeConstructor(e){Di=e}static get __childrenNodeConstructor(){return Di}constructor(e,t=D.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,f(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Zr(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new D(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:D.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return v(e)?this:y(e)===".priority"?this.priorityNode_:D.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:D.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const s=y(e);return s===null?t:t.isEmpty()&&s!==".priority"?this:(f(s!==".priority"||Se(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,D.__childrenNodeConstructor.EMPTY_NODE.updateChild(I(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Xr(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=Ar(this.value_):e+=this.value_,this.lazyHash_=Nr(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===D.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof D.__childrenNodeConstructor?-1:(f(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,s=typeof this.value_,i=D.VALUE_TYPE_ORDER.indexOf(t),r=D.VALUE_TYPE_ORDER.indexOf(s);return f(i>=0,"Unknown leaf type: "+t),f(r>=0,"Unknown leaf type: "+s),i===r?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}D.VALUE_TYPE_ORDER=["object","boolean","number","string"];let eo,to;function Wc(n){eo=n}function Uc(n){to=n}class Hc extends hn{compare(e,t){const s=e.node.getPriority(),i=t.node.getPriority(),r=s.compareTo(i);return r===0?Be(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return w.MIN}maxPost(){return new w(pe,new D("[PRIORITY-POST]",to))}makePost(e,t){const s=eo(e);return new w(t,new D("[PRIORITY-POST]",s))}toString(){return".priority"}}const N=new Hc;const Vc=Math.log(2);class $c{constructor(e){const t=r=>parseInt(Math.log(r)/Vc,10),s=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const i=s(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const qt=function(n,e,t,s){n.sort(e);const i=function(l,c){const u=c-l;let h,d;if(u===0)return null;if(u===1)return h=n[l],d=t?t(h):h,new M(d,h.node,M.BLACK,null,null);{const p=parseInt(u/2,10)+l,_=i(l,p),C=i(p+1,c);return h=n[p],d=t?t(h):h,new M(d,h.node,M.BLACK,_,C)}},r=function(l){let c=null,u=null,h=n.length;const d=function(_,C){const P=h-_,ae=h;h-=_;const le=i(P+1,ae),xe=n[P],xn=t?t(xe):xe;p(new M(xn,xe.node,C,null,le))},p=function(_){c?(c.left=_,c=_):(u=_,c=_)};for(let _=0;_<l.count;++_){const C=l.nextBitIsOne(),P=Math.pow(2,l.count-(_+1));C?d(P,M.BLACK):(d(P,M.BLACK),d(P,M.RED))}return u},o=new $c(n.length),a=r(o);return new V(s||e,a)};let Bn;const He={};class ce{static get Default(){return f(He&&N,"ChildrenNode.ts has not been loaded"),Bn=Bn||new ce({".priority":He},{".priority":N}),Bn}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Oe(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof V?t:null}hasIndex(e){return q(this.indexSet_,e.toString())}addIndex(e,t){f(e!==ie,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let i=!1;const r=t.getIterator(w.Wrap);let o=r.getNext();for(;o;)i=i||e.isDefinedOn(o.node),s.push(o),o=r.getNext();let a;i?a=qt(s,e.getCompare()):a=He;const l=e.toString(),c={...this.indexSet_};c[l]=e;const u={...this.indexes_};return u[l]=a,new ce(u,c)}addToIndexes(e,t){const s=Vt(this.indexes_,(i,r)=>{const o=Oe(this.indexSet_,r);if(f(o,"Missing index implementation for "+r),i===He)if(o.isDefinedOn(e.node)){const a=[],l=t.getIterator(w.Wrap);let c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),qt(a,o.getCompare())}else return He;else{const a=t.get(e.name);let l=i;return a&&(l=l.remove(new w(e.name,a))),l.insert(e,e.node)}});return new ce(s,this.indexSet_)}removeFromIndexes(e,t){const s=Vt(this.indexes_,i=>{if(i===He)return i;{const r=t.get(e.name);return r?i.remove(new w(e.name,r)):i}});return new ce(s,this.indexSet_)}}let at;class m{static get EMPTY_NODE(){return at||(at=new m(new V(As),null,ce.Default))}constructor(e,t,s){this.children_=e,this.priorityNode_=t,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&Zr(this.priorityNode_),this.children_.isEmpty()&&f(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||at}updatePriority(e){return this.children_.isEmpty()?this:new m(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?at:t}}getChild(e){const t=y(e);return t===null?this:this.getImmediateChild(t).getChild(I(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(f(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const s=new w(e,t);let i,r;t.isEmpty()?(i=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(s,this.children_)):(i=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(s,this.children_));const o=i.isEmpty()?at:this.priorityNode_;return new m(i,o,r)}}updateChild(e,t){const s=y(e);if(s===null)return t;{f(y(e)!==".priority"||Se(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(s).updateChild(I(e),t);return this.updateImmediateChild(s,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let s=0,i=0,r=!0;if(this.forEachChild(N,(o,a)=>{t[o]=a.val(e),s++,r&&m.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):r=!1}),!e&&r&&i<2*s){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+Xr(this.getPriority().val())+":"),this.forEachChild(N,(t,s)=>{const i=s.hash();i!==""&&(e+=":"+t+":"+i)}),this.lazyHash_=e===""?"":Nr(e)}return this.lazyHash_}getPredecessorChildName(e,t,s){const i=this.resolveIndex_(s);if(i){const r=i.getPredecessorKey(new w(e,t));return r?r.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new w(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new w(t,this.children_.get(t)):null}forEachChild(e,t){const s=this.resolveIndex_(e);return s?s.inorderTraversal(i=>t(i.name,i.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,w.Wrap);let r=i.peek();for(;r!=null&&t.compare(r,e)<0;)i.getNext(),r=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,w.Wrap);let r=i.peek();for(;r!=null&&t.compare(r,e)>0;)i.getNext(),r=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===xt?-1:0}withIndex(e){if(e===ie||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new m(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===ie||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const s=this.getIterator(N),i=t.getIterator(N);let r=s.getNext(),o=i.getNext();for(;r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=s.getNext(),o=i.getNext()}return r===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===ie?null:this.indexMap_.get(e.toString())}}m.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class zc extends m{constructor(){super(new V(As),m.EMPTY_NODE,ce.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return m.EMPTY_NODE}isEmpty(){return!1}}const xt=new zc;Object.defineProperties(w,{MIN:{value:new w(Ee,m.EMPTY_NODE)},MAX:{value:new w(pe,xt)}});Jr.__EMPTY_NODE=m.EMPTY_NODE;D.__childrenNodeConstructor=m;Bc(xt);Uc(xt);const jc=!0;function x(n,e=null){if(n===null)return m.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),f(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new D(t,x(e))}if(!(n instanceof Array)&&jc){const t=[];let s=!1;if(F(n,(o,a)=>{if(o.substring(0,1)!=="."){const l=x(a);l.isEmpty()||(s=s||!l.getPriority().isEmpty(),t.push(new w(o,l)))}}),t.length===0)return m.EMPTY_NODE;const r=qt(t,Fc,o=>o.name,As);if(s){const o=qt(t,N.getCompare());return new m(r,x(e),new ce({".priority":o},{".priority":N}))}else return new m(r,x(e),ce.Default)}else{let t=m.EMPTY_NODE;return F(n,(s,i)=>{if(q(n,s)&&s.substring(0,1)!=="."){const r=x(i);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(s,r))}}),t.updatePriority(x(e))}}Wc(x);class Ps extends hn{constructor(e){super(),this.indexPath_=e,f(!v(e)&&y(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const s=this.extractChild(e.node),i=this.extractChild(t.node),r=s.compareTo(i);return r===0?Be(e.name,t.name):r}makePost(e,t){const s=x(e),i=m.EMPTY_NODE.updateChild(this.indexPath_,s);return new w(t,i)}maxPost(){const e=m.EMPTY_NODE.updateChild(this.indexPath_,xt);return new w(pe,e)}toString(){return yt(this.indexPath_,0).join("/")}}class Gc extends hn{compare(e,t){const s=e.node.compareTo(t.node);return s===0?Be(e.name,t.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return w.MIN}maxPost(){return w.MAX}makePost(e,t){const s=x(e);return new w(t,s)}toString(){return".value"}}const ks=new Gc;function no(n){return{type:"value",snapshotNode:n}}function Ke(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function vt(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function wt(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function qc(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}class Ds{constructor(e){this.index_=e}updateChild(e,t,s,i,r,o){f(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(i).equals(s.getChild(i))&&a.isEmpty()===s.isEmpty()||(o!=null&&(s.isEmpty()?e.hasChild(t)?o.trackChildChange(vt(t,a)):f(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Ke(t,s)):o.trackChildChange(wt(t,s,a))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(t,s).withIndex(this.index_)}updateFullNode(e,t,s){return s!=null&&(e.isLeafNode()||e.forEachChild(N,(i,r)=>{t.hasChild(i)||s.trackChildChange(vt(i,r))}),t.isLeafNode()||t.forEachChild(N,(i,r)=>{if(e.hasChild(i)){const o=e.getImmediateChild(i);o.equals(r)||s.trackChildChange(wt(i,r,o))}else s.trackChildChange(Ke(i,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?m.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class Ct{constructor(e){this.indexedFilter_=new Ds(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Ct.getStartPost_(e),this.endPost_=Ct.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,s=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&s}updateChild(e,t,s,i,r,o){return this.matches(new w(t,s))||(s=m.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,s,i,r,o)}updateFullNode(e,t,s){t.isLeafNode()&&(t=m.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(m.EMPTY_NODE);const r=this;return t.forEachChild(N,(o,a)=>{r.matches(new w(o,a))||(i=i.updateImmediateChild(o,m.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}class Qc{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const s=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?s<=0:s<0},this.withinEndPost=t=>{const s=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?s<=0:s<0},this.rangedFilter_=new Ct(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,s,i,r,o){return this.rangedFilter_.matches(new w(t,s))||(s=m.EMPTY_NODE),e.getImmediateChild(t).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,s,i,r,o):this.fullLimitUpdateChild_(e,t,s,r,o)}updateFullNode(e,t,s){let i;if(t.isLeafNode()||t.isEmpty())i=m.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=m.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){const a=r.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(m.EMPTY_NODE);let r;this.reverse_?r=i.getReverseIterator(this.index_):r=i.getIterator(this.index_);let o=0;for(;r.hasNext();){const a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,m.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,s,i,r){let o;if(this.reverse_){const h=this.index_.getCompare();o=(d,p)=>h(p,d)}else o=this.index_.getCompare();const a=e;f(a.numChildren()===this.limit_,"");const l=new w(t,s),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),u=this.rangedFilter_.matches(l);if(a.hasChild(t)){const h=a.getImmediateChild(t);let d=i.getChildAfterChild(this.index_,c,this.reverse_);for(;d!=null&&(d.name===t||a.hasChild(d.name));)d=i.getChildAfterChild(this.index_,d,this.reverse_);const p=d==null?1:o(d,l);if(u&&!s.isEmpty()&&p>=0)return r?.trackChildChange(wt(t,s,h)),a.updateImmediateChild(t,s);{r?.trackChildChange(vt(t,h));const C=a.updateImmediateChild(t,m.EMPTY_NODE);return d!=null&&this.rangedFilter_.matches(d)?(r?.trackChildChange(Ke(d.name,d.node)),C.updateImmediateChild(d.name,d.node)):C}}else return s.isEmpty()?e:u&&o(c,l)>=0?(r!=null&&(r.trackChildChange(vt(c.name,c.node)),r.trackChildChange(Ke(t,s))),a.updateImmediateChild(t,s).updateImmediateChild(c.name,m.EMPTY_NODE)):e}}class un{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=N}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return f(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return f(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Ee}hasEnd(){return this.endSet_}getIndexEndValue(){return f(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return f(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:pe}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return f(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===N}copy(){const e=new un;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Kc(n){return n.loadsAllData()?new Ds(n.getIndex()):n.hasLimit()?new Qc(n):new Ct(n)}function Yc(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function Jc(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function Jn(n,e,t){const s=n.copy();return s.startSet_=!0,e===void 0&&(e=null),s.indexStartValue_=e,t!=null?(s.startNameSet_=!0,s.indexStartName_=t):(s.startNameSet_=!1,s.indexStartName_=""),s}function Xc(n,e,t){let s;return n.index_===ie||t?s=Jn(n,e,t):s=Jn(n,e,pe),s.startAfterSet_=!0,s}function Xn(n,e,t){const s=n.copy();return s.endSet_=!0,e===void 0&&(e=null),s.indexEndValue_=e,t!==void 0?(s.endNameSet_=!0,s.indexEndName_=t):(s.endNameSet_=!1,s.indexEndName_=""),s}function Zc(n,e,t){let s;return n.index_===ie||t?s=Xn(n,e,t):s=Xn(n,e,Ee),s.endBeforeSet_=!0,s}function dn(n,e){const t=n.copy();return t.index_=e,t}function Oi(n){const e={};if(n.isDefault())return e;let t;if(n.index_===N?t="$priority":n.index_===ks?t="$value":n.index_===ie?t="$key":(f(n.index_ instanceof Ps,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=k(t),n.startSet_){const s=n.startAfterSet_?"startAfter":"startAt";e[s]=k(n.indexStartValue_),n.startNameSet_&&(e[s]+=","+k(n.indexStartName_))}if(n.endSet_){const s=n.endBeforeSet_?"endBefore":"endAt";e[s]=k(n.indexEndValue_),n.endNameSet_&&(e[s]+=","+k(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function Mi(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==N&&(e.i=n.index_.toString()),e}class Qt extends qr{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(f(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,s,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=s,this.appCheckTokenProvider_=i,this.log_=Rt("p:rest:"),this.listens_={}}listen(e,t,s,i){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=Qt.getListenId_(e,s),a={};this.listens_[o]=a;const l=Oi(e._queryParams);this.restRequest_(r+".json",l,(c,u)=>{let h=u;if(c===404&&(h=null,c=null),c===null&&this.onDataUpdate_(r,h,!1,s),Oe(this.listens_,o)===a){let d;c?c===401?d="permission_denied":d="rest_error:"+c:d="ok",i(d,null)}})}unlisten(e,t){const s=Qt.getListenId_(e,t);delete this.listens_[s]}get(e){const t=Oi(e._queryParams),s=e._path.toString(),i=new H;return this.restRequest_(s+".json",t,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(s,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},s){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+_a(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(s&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=_t(a.responseText)}catch{W("Failed to parse JSON response for "+o+": "+a.responseText)}s(null,l)}else a.status!==401&&a.status!==404&&W("Got unsuccessful REST response for "+o+" Status: "+a.status),s(a.status);s=null}},a.open("GET",o,!0),a.send()})}}class eh{constructor(){this.rootNode_=m.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function Kt(){return{value:null,children:new Map}}function nt(n,e,t){if(v(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const s=y(e);n.children.has(s)||n.children.set(s,Kt());const i=n.children.get(s);e=I(e),nt(i,e,t)}}function Zn(n,e){if(v(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(N,(s,i)=>{nt(n,new E(s),i)}),Zn(n,e)}}else if(n.children.size>0){const t=y(e);return e=I(e),n.children.has(t)&&Zn(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function es(n,e,t){n.value!==null?t(e,n.value):th(n,(s,i)=>{const r=new E(e.toString()+"/"+s);es(i,r,t)})}function th(n,e){n.children.forEach((t,s)=>{e(s,t)})}class nh{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&F(this.last_,(s,i)=>{t[s]=t[s]-i}),this.last_=e,t}}const Li=10*1e3,sh=30*1e3,ih=300*1e3;class rh{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new nh(e);const s=Li+(sh-Li)*Math.random();ht(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),t={};let s=!1;F(e,(i,r)=>{r>0&&q(this.statsToReport_,i)&&(t[i]=r,s=!0)}),s&&this.server_.reportStats(t),ht(this.reportStats_.bind(this),Math.floor(Math.random()*2*ih))}}var te;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(te||(te={}));function Os(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Ms(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Ls(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class Yt{constructor(e,t,s){this.path=e,this.affectedTree=t,this.revert=s,this.type=te.ACK_USER_WRITE,this.source=Os()}operationForChild(e){if(v(this.path)){if(this.affectedTree.value!=null)return f(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new E(e));return new Yt(b(),t,this.revert)}}else return f(y(this.path)===e,"operationForChild called for unrelated child."),new Yt(I(this.path),this.affectedTree,this.revert)}}class bt{constructor(e,t){this.source=e,this.path=t,this.type=te.LISTEN_COMPLETE}operationForChild(e){return v(this.path)?new bt(this.source,b()):new bt(this.source,I(this.path))}}class Me{constructor(e,t,s){this.source=e,this.path=t,this.snap=s,this.type=te.OVERWRITE}operationForChild(e){return v(this.path)?new Me(this.source,b(),this.snap.getImmediateChild(e)):new Me(this.source,I(this.path),this.snap)}}class Ye{constructor(e,t,s){this.source=e,this.path=t,this.children=s,this.type=te.MERGE}operationForChild(e){if(v(this.path)){const t=this.children.subtree(new E(e));return t.isEmpty()?null:t.value?new Me(this.source,b(),t.value):new Ye(this.source,b(),t)}else return f(y(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Ye(this.source,I(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Ie{constructor(e,t,s){this.node_=e,this.fullyInitialized_=t,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(v(e))return this.isFullyInitialized()&&!this.filtered_;const t=y(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class oh{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function ah(n,e,t,s){const i=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(qc(o.childName,o.snapshotNode))}),lt(n,i,"child_removed",e,s,t),lt(n,i,"child_added",e,s,t),lt(n,i,"child_moved",r,s,t),lt(n,i,"child_changed",e,s,t),lt(n,i,"value",e,s,t),i}function lt(n,e,t,s,i,r){const o=s.filter(a=>a.type===t);o.sort((a,l)=>ch(n,a,l)),o.forEach(a=>{const l=lh(n,a,r);i.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,n.query_))})})}function lh(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function ch(n,e,t){if(e.childName==null||t.childName==null)throw Ze("Should only compare child_ events.");const s=new w(e.childName,e.snapshotNode),i=new w(t.childName,t.snapshotNode);return n.index_.compare(s,i)}function fn(n,e){return{eventCache:n,serverCache:e}}function ut(n,e,t,s){return fn(new Ie(e,t,s),n.serverCache)}function so(n,e,t,s){return fn(n.eventCache,new Ie(e,t,s))}function Jt(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Le(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let Wn;const hh=()=>(Wn||(Wn=new V(Gl)),Wn);class T{static fromObject(e){let t=new T(null);return F(e,(s,i)=>{t=t.set(new E(s),i)}),t}constructor(e,t=hh()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:b(),value:this.value};if(v(e))return null;{const s=y(e),i=this.children.get(s);if(i!==null){const r=i.findRootMostMatchingPathAndValue(I(e),t);return r!=null?{path:R(new E(s),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(v(e))return this;{const t=y(e),s=this.children.get(t);return s!==null?s.subtree(I(e)):new T(null)}}set(e,t){if(v(e))return new T(t,this.children);{const s=y(e),r=(this.children.get(s)||new T(null)).set(I(e),t),o=this.children.insert(s,r);return new T(this.value,o)}}remove(e){if(v(e))return this.children.isEmpty()?new T(null):new T(null,this.children);{const t=y(e),s=this.children.get(t);if(s){const i=s.remove(I(e));let r;return i.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,i),this.value===null&&r.isEmpty()?new T(null):new T(this.value,r)}else return this}}get(e){if(v(e))return this.value;{const t=y(e),s=this.children.get(t);return s?s.get(I(e)):null}}setTree(e,t){if(v(e))return t;{const s=y(e),r=(this.children.get(s)||new T(null)).setTree(I(e),t);let o;return r.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,r),new T(this.value,o)}}fold(e){return this.fold_(b(),e)}fold_(e,t){const s={};return this.children.inorderTraversal((i,r)=>{s[i]=r.fold_(R(e,i),t)}),t(e,this.value,s)}findOnPath(e,t){return this.findOnPath_(e,b(),t)}findOnPath_(e,t,s){const i=this.value?s(t,this.value):!1;if(i)return i;if(v(e))return null;{const r=y(e),o=this.children.get(r);return o?o.findOnPath_(I(e),R(t,r),s):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,b(),t)}foreachOnPath_(e,t,s){if(v(e))return this;{this.value&&s(t,this.value);const i=y(e),r=this.children.get(i);return r?r.foreachOnPath_(I(e),R(t,i),s):new T(null)}}foreach(e){this.foreach_(b(),e)}foreach_(e,t){this.children.inorderTraversal((s,i)=>{i.foreach_(R(e,s),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,s)=>{s.value&&e(t,s.value)})}}class ne{constructor(e){this.writeTree_=e}static empty(){return new ne(new T(null))}}function dt(n,e,t){if(v(e))return new ne(new T(t));{const s=n.writeTree_.findRootMostValueAndPath(e);if(s!=null){const i=s.path;let r=s.value;const o=U(i,e);return r=r.updateChild(o,t),new ne(n.writeTree_.set(i,r))}else{const i=new T(t),r=n.writeTree_.setTree(e,i);return new ne(r)}}}function ts(n,e,t){let s=n;return F(t,(i,r)=>{s=dt(s,R(e,i),r)}),s}function Fi(n,e){if(v(e))return ne.empty();{const t=n.writeTree_.setTree(e,new T(null));return new ne(t)}}function ns(n,e){return We(n,e)!=null}function We(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(U(t.path,e)):null}function Bi(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(N,(s,i)=>{e.push(new w(s,i))}):n.writeTree_.children.inorderTraversal((s,i)=>{i.value!=null&&e.push(new w(s,i.value))}),e}function ye(n,e){if(v(e))return n;{const t=We(n,e);return t!=null?new ne(new T(t)):new ne(n.writeTree_.subtree(e))}}function ss(n){return n.writeTree_.isEmpty()}function Je(n,e){return io(b(),n.writeTree_,e)}function io(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let s=null;return e.children.inorderTraversal((i,r)=>{i===".priority"?(f(r.value!==null,"Priority writes must always be leaf nodes"),s=r.value):t=io(R(n,i),r,t)}),!t.getChild(n).isEmpty()&&s!==null&&(t=t.updateChild(R(n,".priority"),s)),t}}function pn(n,e){return lo(e,n)}function uh(n,e,t,s,i){f(s>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:s,visible:i}),i&&(n.visibleWrites=dt(n.visibleWrites,e,t)),n.lastWriteId=s}function dh(n,e,t,s){f(s>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:s,visible:!0}),n.visibleWrites=ts(n.visibleWrites,e,t),n.lastWriteId=s}function fh(n,e){for(let t=0;t<n.allWrites.length;t++){const s=n.allWrites[t];if(s.writeId===e)return s}return null}function ph(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);f(t>=0,"removeWrite called with nonexistent writeId.");const s=n.allWrites[t];n.allWrites.splice(t,1);let i=s.visible,r=!1,o=n.allWrites.length-1;for(;i&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&_h(a,s.path)?i=!1:J(s.path,a.path)&&(r=!0)),o--}if(i){if(r)return mh(n),!0;if(s.snap)n.visibleWrites=Fi(n.visibleWrites,s.path);else{const a=s.children;F(a,l=>{n.visibleWrites=Fi(n.visibleWrites,R(s.path,l))})}return!0}else return!1}function _h(n,e){if(n.snap)return J(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&J(R(n.path,t),e))return!0;return!1}function mh(n){n.visibleWrites=ro(n.allWrites,gh,b()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function gh(n){return n.visible}function ro(n,e,t){let s=ne.empty();for(let i=0;i<n.length;++i){const r=n[i];if(e(r)){const o=r.path;let a;if(r.snap)J(t,o)?(a=U(t,o),s=dt(s,a,r.snap)):J(o,t)&&(a=U(o,t),s=dt(s,b(),r.snap.getChild(a)));else if(r.children){if(J(t,o))a=U(t,o),s=ts(s,a,r.children);else if(J(o,t))if(a=U(o,t),v(a))s=ts(s,b(),r.children);else{const l=Oe(r.children,y(a));if(l){const c=l.getChild(I(a));s=dt(s,b(),c)}}}else throw Ze("WriteRecord should have .snap or .children")}}return s}function oo(n,e,t,s,i){if(!s&&!i){const r=We(n.visibleWrites,e);if(r!=null)return r;{const o=ye(n.visibleWrites,e);if(ss(o))return t;if(t==null&&!ns(o,b()))return null;{const a=t||m.EMPTY_NODE;return Je(o,a)}}}else{const r=ye(n.visibleWrites,e);if(!i&&ss(r))return t;if(!i&&t==null&&!ns(r,b()))return null;{const o=function(c){return(c.visible||i)&&(!s||!~s.indexOf(c.writeId))&&(J(c.path,e)||J(e,c.path))},a=ro(n.allWrites,o,e),l=t||m.EMPTY_NODE;return Je(a,l)}}}function yh(n,e,t){let s=m.EMPTY_NODE;const i=We(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(N,(r,o)=>{s=s.updateImmediateChild(r,o)}),s;if(t){const r=ye(n.visibleWrites,e);return t.forEachChild(N,(o,a)=>{const l=Je(ye(r,new E(o)),a);s=s.updateImmediateChild(o,l)}),Bi(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{const r=ye(n.visibleWrites,e);return Bi(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function vh(n,e,t,s,i){f(s||i,"Either existingEventSnap or existingServerSnap must exist");const r=R(e,t);if(ns(n.visibleWrites,r))return null;{const o=ye(n.visibleWrites,r);return ss(o)?i.getChild(t):Je(o,i.getChild(t))}}function wh(n,e,t,s){const i=R(e,t),r=We(n.visibleWrites,i);if(r!=null)return r;if(s.isCompleteForChild(t)){const o=ye(n.visibleWrites,i);return Je(o,s.getNode().getImmediateChild(t))}else return null}function Ch(n,e){return We(n.visibleWrites,e)}function bh(n,e,t,s,i,r,o){let a;const l=ye(n.visibleWrites,e),c=We(l,b());if(c!=null)a=c;else if(t!=null)a=Je(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const u=[],h=o.getCompare(),d=r?a.getReverseIteratorFrom(s,o):a.getIteratorFrom(s,o);let p=d.getNext();for(;p&&u.length<i;)h(p,s)!==0&&u.push(p),p=d.getNext();return u}else return[]}function Eh(){return{visibleWrites:ne.empty(),allWrites:[],lastWriteId:-1}}function Xt(n,e,t,s){return oo(n.writeTree,n.treePath,e,t,s)}function Fs(n,e){return yh(n.writeTree,n.treePath,e)}function Wi(n,e,t,s){return vh(n.writeTree,n.treePath,e,t,s)}function Zt(n,e){return Ch(n.writeTree,R(n.treePath,e))}function Sh(n,e,t,s,i,r){return bh(n.writeTree,n.treePath,e,t,s,i,r)}function Bs(n,e,t){return wh(n.writeTree,n.treePath,e,t)}function ao(n,e){return lo(R(n.treePath,e),n.writeTree)}function lo(n,e){return{treePath:n,writeTree:e}}class Ih{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,s=e.childName;f(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),f(s!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(s);if(i){const r=i.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(s,wt(s,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(s);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(s,vt(s,i.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(s,Ke(s,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(s,wt(s,e.snapshotNode,i.oldSnap));else throw Ze("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}class Th{getCompleteChild(e){return null}getChildAfterChild(e,t,s){return null}}const co=new Th;class Ws{constructor(e,t,s=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=s}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const s=this.optCompleteServerCache_!=null?new Ie(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Bs(this.writes_,e,s)}}getChildAfterChild(e,t,s){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Le(this.viewCache_),r=Sh(this.writes_,i,t,1,s,e);return r.length===0?null:r[0]}}function Nh(n){return{filter:n}}function Rh(n,e){f(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),f(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function xh(n,e,t,s,i){const r=new Ih;let o,a;if(t.type===te.OVERWRITE){const c=t;c.source.fromUser?o=is(n,e,c.path,c.snap,s,i,r):(f(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!v(c.path),o=en(n,e,c.path,c.snap,s,i,a,r))}else if(t.type===te.MERGE){const c=t;c.source.fromUser?o=Ph(n,e,c.path,c.children,s,i,r):(f(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=rs(n,e,c.path,c.children,s,i,a,r))}else if(t.type===te.ACK_USER_WRITE){const c=t;c.revert?o=Oh(n,e,c.path,s,i,r):o=kh(n,e,c.path,c.affectedTree,s,i,r)}else if(t.type===te.LISTEN_COMPLETE)o=Dh(n,e,t.path,s,r);else throw Ze("Unknown operation type: "+t.type);const l=r.getChanges();return Ah(e,o,l),{viewCache:o,changes:l}}function Ah(n,e,t){const s=e.eventCache;if(s.isFullyInitialized()){const i=s.getNode().isLeafNode()||s.getNode().isEmpty(),r=Jt(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!s.getNode().equals(r)||!s.getNode().getPriority().equals(r.getPriority()))&&t.push(no(Jt(e)))}}function ho(n,e,t,s,i,r){const o=e.eventCache;if(Zt(s,t)!=null)return e;{let a,l;if(v(t))if(f(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const c=Le(e),u=c instanceof m?c:m.EMPTY_NODE,h=Fs(s,u);a=n.filter.updateFullNode(e.eventCache.getNode(),h,r)}else{const c=Xt(s,Le(e));a=n.filter.updateFullNode(e.eventCache.getNode(),c,r)}else{const c=y(t);if(c===".priority"){f(Se(t)===1,"Can't have a priority with additional path components");const u=o.getNode();l=e.serverCache.getNode();const h=Wi(s,t,u,l);h!=null?a=n.filter.updatePriority(u,h):a=o.getNode()}else{const u=I(t);let h;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();const d=Wi(s,t,o.getNode(),l);d!=null?h=o.getNode().getImmediateChild(c).updateChild(u,d):h=o.getNode().getImmediateChild(c)}else h=Bs(s,c,e.serverCache);h!=null?a=n.filter.updateChild(o.getNode(),c,h,u,i,r):a=o.getNode()}}return ut(e,a,o.isFullyInitialized()||v(t),n.filter.filtersNodes())}}function en(n,e,t,s,i,r,o,a){const l=e.serverCache;let c;const u=o?n.filter:n.filter.getIndexedFilter();if(v(t))c=u.updateFullNode(l.getNode(),s,null);else if(u.filtersNodes()&&!l.isFiltered()){const p=l.getNode().updateChild(t,s);c=u.updateFullNode(l.getNode(),p,null)}else{const p=y(t);if(!l.isCompleteForPath(t)&&Se(t)>1)return e;const _=I(t),P=l.getNode().getImmediateChild(p).updateChild(_,s);p===".priority"?c=u.updatePriority(l.getNode(),P):c=u.updateChild(l.getNode(),p,P,_,co,null)}const h=so(e,c,l.isFullyInitialized()||v(t),u.filtersNodes()),d=new Ws(i,h,r);return ho(n,h,t,i,d,a)}function is(n,e,t,s,i,r,o){const a=e.eventCache;let l,c;const u=new Ws(i,e,r);if(v(t))c=n.filter.updateFullNode(e.eventCache.getNode(),s,o),l=ut(e,c,!0,n.filter.filtersNodes());else{const h=y(t);if(h===".priority")c=n.filter.updatePriority(e.eventCache.getNode(),s),l=ut(e,c,a.isFullyInitialized(),a.isFiltered());else{const d=I(t),p=a.getNode().getImmediateChild(h);let _;if(v(d))_=s;else{const C=u.getCompleteChild(h);C!=null?Ns(d)===".priority"&&C.getChild(Kr(d)).isEmpty()?_=C:_=C.updateChild(d,s):_=m.EMPTY_NODE}if(p.equals(_))l=e;else{const C=n.filter.updateChild(a.getNode(),h,_,d,u,o);l=ut(e,C,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function Ui(n,e){return n.eventCache.isCompleteForChild(e)}function Ph(n,e,t,s,i,r,o){let a=e;return s.foreach((l,c)=>{const u=R(t,l);Ui(e,y(u))&&(a=is(n,a,u,c,i,r,o))}),s.foreach((l,c)=>{const u=R(t,l);Ui(e,y(u))||(a=is(n,a,u,c,i,r,o))}),a}function Hi(n,e,t){return t.foreach((s,i)=>{e=e.updateChild(s,i)}),e}function rs(n,e,t,s,i,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;v(t)?c=s:c=new T(null).setTree(t,s);const u=e.serverCache.getNode();return c.children.inorderTraversal((h,d)=>{if(u.hasChild(h)){const p=e.serverCache.getNode().getImmediateChild(h),_=Hi(n,p,d);l=en(n,l,new E(h),_,i,r,o,a)}}),c.children.inorderTraversal((h,d)=>{const p=!e.serverCache.isCompleteForChild(h)&&d.value===null;if(!u.hasChild(h)&&!p){const _=e.serverCache.getNode().getImmediateChild(h),C=Hi(n,_,d);l=en(n,l,new E(h),C,i,r,o,a)}}),l}function kh(n,e,t,s,i,r,o){if(Zt(i,t)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(s.value!=null){if(v(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return en(n,e,t,l.getNode().getChild(t),i,r,a,o);if(v(t)){let c=new T(null);return l.getNode().forEachChild(ie,(u,h)=>{c=c.set(new E(u),h)}),rs(n,e,t,c,i,r,a,o)}else return e}else{let c=new T(null);return s.foreach((u,h)=>{const d=R(t,u);l.isCompleteForPath(d)&&(c=c.set(u,l.getNode().getChild(d)))}),rs(n,e,t,c,i,r,a,o)}}function Dh(n,e,t,s,i){const r=e.serverCache,o=so(e,r.getNode(),r.isFullyInitialized()||v(t),r.isFiltered());return ho(n,o,t,s,co,i)}function Oh(n,e,t,s,i,r){let o;if(Zt(s,t)!=null)return e;{const a=new Ws(s,e,i),l=e.eventCache.getNode();let c;if(v(t)||y(t)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=Xt(s,Le(e));else{const h=e.serverCache.getNode();f(h instanceof m,"serverChildren would be complete if leaf node"),u=Fs(s,h)}u=u,c=n.filter.updateFullNode(l,u,r)}else{const u=y(t);let h=Bs(s,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=l.getImmediateChild(u)),h!=null?c=n.filter.updateChild(l,u,h,I(t),a,r):e.eventCache.getNode().hasChild(u)?c=n.filter.updateChild(l,u,m.EMPTY_NODE,I(t),a,r):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Xt(s,Le(e)),o.isLeafNode()&&(c=n.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||Zt(s,b())!=null,ut(e,c,o,n.filter.filtersNodes())}}class Mh{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const s=this.query_._queryParams,i=new Ds(s.getIndex()),r=Kc(s);this.processor_=Nh(r);const o=t.serverCache,a=t.eventCache,l=i.updateFullNode(m.EMPTY_NODE,o.getNode(),null),c=r.updateFullNode(m.EMPTY_NODE,a.getNode(),null),u=new Ie(l,o.isFullyInitialized(),i.filtersNodes()),h=new Ie(c,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=fn(h,u),this.eventGenerator_=new oh(this.query_)}get query(){return this.query_}}function Lh(n){return n.viewCache_.serverCache.getNode()}function Fh(n){return Jt(n.viewCache_)}function Bh(n,e){const t=Le(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!v(e)&&!t.getImmediateChild(y(e)).isEmpty())?t.getChild(e):null}function Vi(n){return n.eventRegistrations_.length===0}function Wh(n,e){n.eventRegistrations_.push(e)}function $i(n,e,t){const s=[];if(t){f(e==null,"A cancel should cancel all event registrations.");const i=n.query._path;n.eventRegistrations_.forEach(r=>{const o=r.createCancelEvent(t,i);o&&s.push(o)})}if(e){let i=[];for(let r=0;r<n.eventRegistrations_.length;++r){const o=n.eventRegistrations_[r];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(r+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return s}function zi(n,e,t,s){e.type===te.MERGE&&e.source.queryId!==null&&(f(Le(n.viewCache_),"We should always have a full cache before handling merges"),f(Jt(n.viewCache_),"Missing event cache, even though we have a server cache"));const i=n.viewCache_,r=xh(n.processor_,i,e,t,s);return Rh(n.processor_,r.viewCache),f(r.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,uo(n,r.changes,r.viewCache.eventCache.getNode(),null)}function Uh(n,e){const t=n.viewCache_.eventCache,s=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(N,(r,o)=>{s.push(Ke(r,o))}),t.isFullyInitialized()&&s.push(no(t.getNode())),uo(n,s,t.getNode(),e)}function uo(n,e,t,s){const i=s?[s]:n.eventRegistrations_;return ah(n.eventGenerator_,e,t,i)}let tn;class fo{constructor(){this.views=new Map}}function Hh(n){f(!tn,"__referenceConstructor has already been defined"),tn=n}function Vh(){return f(tn,"Reference.ts has not been loaded"),tn}function $h(n){return n.views.size===0}function Us(n,e,t,s){const i=e.source.queryId;if(i!==null){const r=n.views.get(i);return f(r!=null,"SyncTree gave us an op for an invalid query."),zi(r,e,t,s)}else{let r=[];for(const o of n.views.values())r=r.concat(zi(o,e,t,s));return r}}function po(n,e,t,s,i){const r=e._queryIdentifier,o=n.views.get(r);if(!o){let a=Xt(t,i?s:null),l=!1;a?l=!0:s instanceof m?(a=Fs(t,s),l=!1):(a=m.EMPTY_NODE,l=!1);const c=fn(new Ie(a,l,!1),new Ie(s,i,!1));return new Mh(e,c)}return o}function zh(n,e,t,s,i,r){const o=po(n,e,s,i,r);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),Wh(o,t),Uh(o,t)}function jh(n,e,t,s){const i=e._queryIdentifier,r=[];let o=[];const a=Te(n);if(i==="default")for(const[l,c]of n.views.entries())o=o.concat($i(c,t,s)),Vi(c)&&(n.views.delete(l),c.query._queryParams.loadsAllData()||r.push(c.query));else{const l=n.views.get(i);l&&(o=o.concat($i(l,t,s)),Vi(l)&&(n.views.delete(i),l.query._queryParams.loadsAllData()||r.push(l.query)))}return a&&!Te(n)&&r.push(new(Vh())(e._repo,e._path)),{removed:r,events:o}}function _o(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function ve(n,e){let t=null;for(const s of n.views.values())t=t||Bh(s,e);return t}function mo(n,e){if(e._queryParams.loadsAllData())return _n(n);{const s=e._queryIdentifier;return n.views.get(s)}}function go(n,e){return mo(n,e)!=null}function Te(n){return _n(n)!=null}function _n(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let nn;function Gh(n){f(!nn,"__referenceConstructor has already been defined"),nn=n}function qh(){return f(nn,"Reference.ts has not been loaded"),nn}let Qh=1;class ji{constructor(e){this.listenProvider_=e,this.syncPointTree_=new T(null),this.pendingWriteTree_=Eh(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Hs(n,e,t,s,i){return uh(n.pendingWriteTree_,e,t,s,i),i?st(n,new Me(Os(),e,t)):[]}function Kh(n,e,t,s){dh(n.pendingWriteTree_,e,t,s);const i=T.fromObject(t);return st(n,new Ye(Os(),e,i))}function me(n,e,t=!1){const s=fh(n.pendingWriteTree_,e);if(ph(n.pendingWriteTree_,e)){let r=new T(null);return s.snap!=null?r=r.set(b(),!0):F(s.children,o=>{r=r.set(new E(o),!0)}),st(n,new Yt(s.path,r,t))}else return[]}function At(n,e,t){return st(n,new Me(Ms(),e,t))}function Yh(n,e,t){const s=T.fromObject(t);return st(n,new Ye(Ms(),e,s))}function Jh(n,e){return st(n,new bt(Ms(),e))}function Xh(n,e,t){const s=Vs(n,t);if(s){const i=$s(s),r=i.path,o=i.queryId,a=U(r,e),l=new bt(Ls(o),a);return zs(n,r,l)}else return[]}function sn(n,e,t,s,i=!1){const r=e._path,o=n.syncPointTree_.get(r);let a=[];if(o&&(e._queryIdentifier==="default"||go(o,e))){const l=jh(o,e,t,s);$h(o)&&(n.syncPointTree_=n.syncPointTree_.remove(r));const c=l.removed;if(a=l.events,!i){const u=c.findIndex(d=>d._queryParams.loadsAllData())!==-1,h=n.syncPointTree_.findOnPath(r,(d,p)=>Te(p));if(u&&!h){const d=n.syncPointTree_.subtree(r);if(!d.isEmpty()){const p=tu(d);for(let _=0;_<p.length;++_){const C=p[_],P=C.query,ae=Co(n,C);n.listenProvider_.startListening(ft(P),Et(n,P),ae.hashFn,ae.onComplete)}}}!h&&c.length>0&&!s&&(u?n.listenProvider_.stopListening(ft(e),null):c.forEach(d=>{const p=n.queryToTagMap.get(gn(d));n.listenProvider_.stopListening(ft(d),p)}))}nu(n,c)}return a}function yo(n,e,t,s){const i=Vs(n,s);if(i!=null){const r=$s(i),o=r.path,a=r.queryId,l=U(o,e),c=new Me(Ls(a),l,t);return zs(n,o,c)}else return[]}function Zh(n,e,t,s){const i=Vs(n,s);if(i){const r=$s(i),o=r.path,a=r.queryId,l=U(o,e),c=T.fromObject(t),u=new Ye(Ls(a),l,c);return zs(n,o,u)}else return[]}function os(n,e,t,s=!1){const i=e._path;let r=null,o=!1;n.syncPointTree_.foreachOnPath(i,(d,p)=>{const _=U(d,i);r=r||ve(p,_),o=o||Te(p)});let a=n.syncPointTree_.get(i);a?(o=o||Te(a),r=r||ve(a,b())):(a=new fo,n.syncPointTree_=n.syncPointTree_.set(i,a));let l;r!=null?l=!0:(l=!1,r=m.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((p,_)=>{const C=ve(_,b());C&&(r=r.updateImmediateChild(p,C))}));const c=go(a,e);if(!c&&!e._queryParams.loadsAllData()){const d=gn(e);f(!n.queryToTagMap.has(d),"View does not exist, but we have a tag");const p=su();n.queryToTagMap.set(d,p),n.tagToQueryMap.set(p,d)}const u=pn(n.pendingWriteTree_,i);let h=zh(a,e,t,u,r,l);if(!c&&!o&&!s){const d=mo(a,e);h=h.concat(iu(n,e,d))}return h}function mn(n,e,t){const i=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,a)=>{const l=U(o,e),c=ve(a,l);if(c)return c});return oo(i,e,r,t,!0)}function eu(n,e){const t=e._path;let s=null;n.syncPointTree_.foreachOnPath(t,(c,u)=>{const h=U(c,t);s=s||ve(u,h)});let i=n.syncPointTree_.get(t);i?s=s||ve(i,b()):(i=new fo,n.syncPointTree_=n.syncPointTree_.set(t,i));const r=s!=null,o=r?new Ie(s,!0,!1):null,a=pn(n.pendingWriteTree_,e._path),l=po(i,e,a,r?o.getNode():m.EMPTY_NODE,r);return Fh(l)}function st(n,e){return vo(e,n.syncPointTree_,null,pn(n.pendingWriteTree_,b()))}function vo(n,e,t,s){if(v(n.path))return wo(n,e,t,s);{const i=e.get(b());t==null&&i!=null&&(t=ve(i,b()));let r=[];const o=y(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){const c=t?t.getImmediateChild(o):null,u=ao(s,o);r=r.concat(vo(a,l,c,u))}return i&&(r=r.concat(Us(i,n,s,t))),r}}function wo(n,e,t,s){const i=e.get(b());t==null&&i!=null&&(t=ve(i,b()));let r=[];return e.children.inorderTraversal((o,a)=>{const l=t?t.getImmediateChild(o):null,c=ao(s,o),u=n.operationForChild(o);u&&(r=r.concat(wo(u,a,l,c)))}),i&&(r=r.concat(Us(i,n,s,t))),r}function Co(n,e){const t=e.query,s=Et(n,t);return{hashFn:()=>(Lh(e)||m.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return s?Xh(n,t._path,s):Jh(n,t._path);{const r=Kl(i,t);return sn(n,t,null,r)}}}}function Et(n,e){const t=gn(e);return n.queryToTagMap.get(t)}function gn(n){return n._path.toString()+"$"+n._queryIdentifier}function Vs(n,e){return n.tagToQueryMap.get(e)}function $s(n){const e=n.indexOf("$");return f(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new E(n.substr(0,e))}}function zs(n,e,t){const s=n.syncPointTree_.get(e);f(s,"Missing sync point for query tag that we're tracking");const i=pn(n.pendingWriteTree_,e);return Us(s,t,i,null)}function tu(n){return n.fold((e,t,s)=>{if(t&&Te(t))return[_n(t)];{let i=[];return t&&(i=_o(t)),F(s,(r,o)=>{i=i.concat(o)}),i}})}function ft(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(qh())(n._repo,n._path):n}function nu(n,e){for(let t=0;t<e.length;++t){const s=e[t];if(!s._queryParams.loadsAllData()){const i=gn(s),r=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(r)}}}function su(){return Qh++}function iu(n,e,t){const s=e._path,i=Et(n,e),r=Co(n,t),o=n.listenProvider_.startListening(ft(e),i,r.hashFn,r.onComplete),a=n.syncPointTree_.subtree(s);if(i)f(!Te(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((c,u,h)=>{if(!v(c)&&u&&Te(u))return[_n(u).query];{let d=[];return u&&(d=d.concat(_o(u).map(p=>p.query))),F(h,(p,_)=>{d=d.concat(_)}),d}});for(let c=0;c<l.length;++c){const u=l[c];n.listenProvider_.stopListening(ft(u),Et(n,u))}}return o}class js{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new js(t)}node(){return this.node_}}class Gs{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=R(this.path_,e);return new Gs(this.syncTree_,t)}node(){return mn(this.syncTree_,this.path_)}}const ru=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},Gi=function(n,e,t){if(!n||typeof n!="object")return n;if(f(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return ou(n[".sv"],e,t);if(typeof n[".sv"]=="object")return au(n[".sv"],e);f(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},ou=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:f(!1,"Unexpected server value: "+n)}},au=function(n,e,t){n.hasOwnProperty("increment")||f(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const s=n.increment;typeof s!="number"&&f(!1,"Unexpected increment value: "+s);const i=e.node();if(f(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return s;const o=i.getValue();return typeof o!="number"?s:o+s},bo=function(n,e,t,s){return Qs(e,new Gs(t,n),s)},qs=function(n,e,t){return Qs(n,new js(e),t)};function Qs(n,e,t){const s=n.getPriority().val(),i=Gi(s,e.getImmediateChild(".priority"),t);let r;if(n.isLeafNode()){const o=n,a=Gi(o.getValue(),e,t);return a!==o.getValue()||i!==o.getPriority().val()?new D(a,x(i)):n}else{const o=n;return r=o,i!==o.getPriority().val()&&(r=r.updatePriority(new D(i))),o.forEachChild(N,(a,l)=>{const c=Qs(l,e.getImmediateChild(a),t);c!==l&&(r=r.updateImmediateChild(a,c))}),r}}class Ks{constructor(e="",t=null,s={children:{},childCount:0}){this.name=e,this.parent=t,this.node=s}}function yn(n,e){let t=e instanceof E?e:new E(e),s=n,i=y(t);for(;i!==null;){const r=Oe(s.node.children,i)||{children:{},childCount:0};s=new Ks(i,s,r),t=I(t),i=y(t)}return s}function Ue(n){return n.node.value}function Ys(n,e){n.node.value=e,as(n)}function Eo(n){return n.node.childCount>0}function lu(n){return Ue(n)===void 0&&!Eo(n)}function vn(n,e){F(n.node.children,(t,s)=>{e(new Ks(t,n,s))})}function So(n,e,t,s){t&&e(n),vn(n,i=>{So(i,e,!0)})}function cu(n,e,t){let s=n.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function Pt(n){return new E(n.parent===null?n.name:Pt(n.parent)+"/"+n.name)}function as(n){n.parent!==null&&hu(n.parent,n.name,n)}function hu(n,e,t){const s=lu(t),i=q(n.node.children,e);s&&i?(delete n.node.children[e],n.node.childCount--,as(n)):!s&&!i&&(n.node.children[e]=t.node,n.node.childCount++,as(n))}const uu=/[\[\].#$\/\u0000-\u001F\u007F]/,du=/[\[\].#$\u0000-\u001F\u007F]/,Un=10*1024*1024,wn=function(n){return typeof n=="string"&&n.length!==0&&!uu.test(n)},Io=function(n){return typeof n=="string"&&n.length!==0&&!du.test(n)},fu=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Io(n)},St=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!cn(n)||n&&typeof n=="object"&&q(n,".sv")},oe=function(n,e,t,s){s&&e===void 0||kt($(n,"value"),e,t)},kt=function(n,e,t){const s=t instanceof E?new xc(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+Pe(s));if(typeof e=="function")throw new Error(n+"contains a function "+Pe(s)+" with contents = "+e.toString());if(cn(e))throw new Error(n+"contains "+e.toString()+" "+Pe(s));if(typeof e=="string"&&e.length>Un/3&&on(e)>Un)throw new Error(n+"contains a string greater than "+Un+" utf8 bytes "+Pe(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,r=!1;if(F(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!wn(o)))throw new Error(n+" contains an invalid key ("+o+") "+Pe(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Ac(s,o),kt(n,a,s),Pc(s)}),i&&r)throw new Error(n+' contains ".value" child '+Pe(s)+" in addition to actual children.")}},pu=function(n,e){let t,s;for(t=0;t<e.length;t++){s=e[t];const r=yt(s);for(let o=0;o<r.length;o++)if(!(r[o]===".priority"&&o===r.length-1)){if(!wn(r[o]))throw new Error(n+"contains an invalid key ("+r[o]+") in path "+s.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(Rc);let i=null;for(t=0;t<e.length;t++){if(s=e[t],i!==null&&J(i,s))throw new Error(n+"contains a path "+i.toString()+" that is ancestor of another path "+s.toString());i=s}},To=function(n,e,t,s){const i=$(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");const r=[];F(e,(o,a)=>{const l=new E(o);if(kt(i,a,R(t,l)),Ns(l)===".priority"&&!St(a))throw new Error(i+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(l)}),pu(i,r)},Js=function(n,e,t){if(cn(e))throw new Error($(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!St(e))throw new Error($(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")},Dt=function(n,e,t,s){if(t!==void 0&&!wn(t))throw new Error($(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},It=function(n,e,t,s){if(!Io(t))throw new Error($(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},_u=function(n,e,t,s){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),It(n,e,t)},X=function(n,e){if(y(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},No=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!wn(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!fu(t))throw new Error($(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class mu{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Cn(n,e){let t=null;for(let s=0;s<e.length;s++){const i=e[s],r=i.getPath();t!==null&&!Rs(r,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(i)}t&&n.eventLists_.push(t)}function Ro(n,e,t){Cn(n,t),xo(n,s=>Rs(s,e))}function Q(n,e,t){Cn(n,t),xo(n,s=>J(s,e)||J(e,s))}function xo(n,e){n.recursionDepth_++;let t=!0;for(let s=0;s<n.eventLists_.length;s++){const i=n.eventLists_[s];if(i){const r=i.path;e(r)?(gu(n.eventLists_[s]),n.eventLists_[s]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function gu(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const s=t.getEventRunner();De&&L("event: "+t.toString()),tt(s)}}}const Ao="repo_interrupt",yu=25;class vu{constructor(e,t,s,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=s,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new mu,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Kt(),this.transactionQueueTree_=new Ks,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function wu(n,e,t){if(n.stats_=Is(n.repoInfo_),n.forceRestClient_||Zl())n.server_=new Qt(n.repoInfo_,(s,i,r,o)=>{qi(n,s,i,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Qi(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{k(t)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}n.persistentConnection_=new ue(n.repoInfo_,e,(s,i,r,o)=>{qi(n,s,i,r,o)},s=>{Qi(n,s)},s=>{Cu(n,s)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(s=>{n.server_.refreshAuthToken(s)}),n.appCheckProvider_.addTokenChangeListener(s=>{n.server_.refreshAppCheckToken(s.token)}),n.statsReporter_=ic(n.repoInfo_,()=>new rh(n.stats_,n.server_)),n.infoData_=new eh,n.infoSyncTree_=new ji({startListening:(s,i,r,o)=>{let a=[];const l=n.infoData_.getNode(s._path);return l.isEmpty()||(a=At(n.infoSyncTree_,s._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Xs(n,"connected",!1),n.serverSyncTree_=new ji({startListening:(s,i,r,o)=>(n.server_.listen(s,r,i,(a,l)=>{const c=o(a,l);Q(n.eventQueue_,s._path,c)}),[]),stopListening:(s,i)=>{n.server_.unlisten(s,i)}})}function Po(n){const t=n.infoData_.getNode(new E(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Ot(n){return ru({timestamp:Po(n)})}function qi(n,e,t,s,i){n.dataUpdateCount++;const r=new E(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(s){const l=Vt(t,c=>x(c));o=Zh(n.serverSyncTree_,r,l,i)}else{const l=x(t);o=yo(n.serverSyncTree_,r,l,i)}else if(s){const l=Vt(t,c=>x(c));o=Yh(n.serverSyncTree_,r,l)}else{const l=x(t);o=At(n.serverSyncTree_,r,l)}let a=r;o.length>0&&(a=Xe(n,r)),Q(n.eventQueue_,a,o)}function Qi(n,e){Xs(n,"connected",e),e===!1&&Su(n)}function Cu(n,e){F(e,(t,s)=>{Xs(n,t,s)})}function Xs(n,e,t){const s=new E("/.info/"+e),i=x(t);n.infoData_.updateSnapshot(s,i);const r=At(n.infoSyncTree_,s,i);Q(n.eventQueue_,s,r)}function bn(n){return n.nextWriteId_++}function bu(n,e,t){const s=eu(n.serverSyncTree_,e);return s!=null?Promise.resolve(s):n.server_.get(e).then(i=>{const r=x(i).withIndex(e._queryParams.getIndex());os(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=At(n.serverSyncTree_,e._path,r);else{const a=Et(n.serverSyncTree_,e);o=yo(n.serverSyncTree_,e._path,r,a)}return Q(n.eventQueue_,e._path,o),sn(n.serverSyncTree_,e,t,null,!0),r},i=>(it(n,"get for query "+k(e)+" failed: "+i),Promise.reject(new Error(i))))}function Zs(n,e,t,s,i){it(n,"set",{path:e.toString(),value:t,priority:s});const r=Ot(n),o=x(t,s),a=mn(n.serverSyncTree_,e),l=qs(o,a,r),c=bn(n),u=Hs(n.serverSyncTree_,e,l,c,!0);Cn(n.eventQueue_,u),n.server_.put(e.toString(),o.val(!0),(d,p)=>{const _=d==="ok";_||W("set at "+e+" failed: "+d);const C=me(n.serverSyncTree_,c,!_);Q(n.eventQueue_,e,C),Ne(n,i,d,p)});const h=ti(n,e);Xe(n,h),Q(n.eventQueue_,h,[])}function Eu(n,e,t,s){it(n,"update",{path:e.toString(),value:t});let i=!0;const r=Ot(n),o={};if(F(t,(a,l)=>{i=!1,o[a]=bo(R(e,a),x(l),n.serverSyncTree_,r)}),i)L("update() called with empty data.  Don't do anything."),Ne(n,s,"ok",void 0);else{const a=bn(n),l=Kh(n.serverSyncTree_,e,o,a);Cn(n.eventQueue_,l),n.server_.merge(e.toString(),t,(c,u)=>{const h=c==="ok";h||W("update at "+e+" failed: "+c);const d=me(n.serverSyncTree_,a,!h),p=d.length>0?Xe(n,e):e;Q(n.eventQueue_,p,d),Ne(n,s,c,u)}),F(t,c=>{const u=ti(n,R(e,c));Xe(n,u)}),Q(n.eventQueue_,e,[])}}function Su(n){it(n,"onDisconnectEvents");const e=Ot(n),t=Kt();es(n.onDisconnect_,b(),(i,r)=>{const o=bo(i,r,n.serverSyncTree_,e);nt(t,i,o)});let s=[];es(t,b(),(i,r)=>{s=s.concat(At(n.serverSyncTree_,i,r));const o=ti(n,i);Xe(n,o)}),n.onDisconnect_=Kt(),Q(n.eventQueue_,b(),s)}function Iu(n,e,t){n.server_.onDisconnectCancel(e.toString(),(s,i)=>{s==="ok"&&Zn(n.onDisconnect_,e),Ne(n,t,s,i)})}function Ki(n,e,t,s){const i=x(t);n.server_.onDisconnectPut(e.toString(),i.val(!0),(r,o)=>{r==="ok"&&nt(n.onDisconnect_,e,i),Ne(n,s,r,o)})}function Tu(n,e,t,s,i){const r=x(t,s);n.server_.onDisconnectPut(e.toString(),r.val(!0),(o,a)=>{o==="ok"&&nt(n.onDisconnect_,e,r),Ne(n,i,o,a)})}function Nu(n,e,t,s){if(Vn(t)){L("onDisconnect().update() called with empty data.  Don't do anything."),Ne(n,s,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(i,r)=>{i==="ok"&&F(t,(o,a)=>{const l=x(a);nt(n.onDisconnect_,R(e,o),l)}),Ne(n,s,i,r)})}function Ru(n,e,t){let s;y(e._path)===".info"?s=os(n.infoSyncTree_,e,t):s=os(n.serverSyncTree_,e,t),Ro(n.eventQueue_,e._path,s)}function ls(n,e,t){let s;y(e._path)===".info"?s=sn(n.infoSyncTree_,e,t):s=sn(n.serverSyncTree_,e,t),Ro(n.eventQueue_,e._path,s)}function ko(n){n.persistentConnection_&&n.persistentConnection_.interrupt(Ao)}function xu(n){n.persistentConnection_&&n.persistentConnection_.resume(Ao)}function it(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),L(t,...e)}function Ne(n,e,t,s){e&&tt(()=>{if(t==="ok")e(null);else{const i=(t||"error").toUpperCase();let r=i;s&&(r+=": "+s);const o=new Error(r);o.code=i,e(o)}})}function Au(n,e,t,s,i,r){it(n,"transaction on "+e);const o={path:e,update:t,onComplete:s,status:null,order:Tr(),applyLocally:r,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=ei(n,e,void 0);o.currentInputSnapshot=a;const l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{kt("transaction failed: Data returned ",l,o.path),o.status=0;const c=yn(n.transactionQueueTree_,e),u=Ue(c)||[];u.push(o),Ys(c,u);let h;typeof l=="object"&&l!==null&&q(l,".priority")?(h=Oe(l,".priority"),f(St(h),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):h=(mn(n.serverSyncTree_,e)||m.EMPTY_NODE).getPriority().val();const d=Ot(n),p=x(l,h),_=qs(p,a,d);o.currentOutputSnapshotRaw=p,o.currentOutputSnapshotResolved=_,o.currentWriteId=bn(n);const C=Hs(n.serverSyncTree_,e,_,o.currentWriteId,o.applyLocally);Q(n.eventQueue_,e,C),En(n,n.transactionQueueTree_)}}function ei(n,e,t){return mn(n.serverSyncTree_,e,t)||m.EMPTY_NODE}function En(n,e=n.transactionQueueTree_){if(e||Sn(n,e),Ue(e)){const t=Oo(n,e);f(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&Pu(n,Pt(e),t)}else Eo(e)&&vn(e,t=>{En(n,t)})}function Pu(n,e,t){const s=t.map(c=>c.currentWriteId),i=ei(n,e,s);let r=i;const o=i.hash();for(let c=0;c<t.length;c++){const u=t[c];f(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;const h=U(e,u.path);r=r.updateChild(h,u.currentOutputSnapshotRaw)}const a=r.val(!0),l=e;n.server_.put(l.toString(),a,c=>{it(n,"transaction put response",{path:l.toString(),status:c});let u=[];if(c==="ok"){const h=[];for(let d=0;d<t.length;d++)t[d].status=2,u=u.concat(me(n.serverSyncTree_,t[d].currentWriteId)),t[d].onComplete&&h.push(()=>t[d].onComplete(null,!0,t[d].currentOutputSnapshotResolved)),t[d].unwatcher();Sn(n,yn(n.transactionQueueTree_,e)),En(n,n.transactionQueueTree_),Q(n.eventQueue_,e,u);for(let d=0;d<h.length;d++)tt(h[d])}else{if(c==="datastale")for(let h=0;h<t.length;h++)t[h].status===3?t[h].status=4:t[h].status=0;else{W("transaction at "+l.toString()+" failed: "+c);for(let h=0;h<t.length;h++)t[h].status=4,t[h].abortReason=c}Xe(n,e)}},o)}function Xe(n,e){const t=Do(n,e),s=Pt(t),i=Oo(n,t);return ku(n,i,s),s}function ku(n,e,t){if(e.length===0)return;const s=[];let i=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],c=U(t,l.path);let u=!1,h;if(f(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)u=!0,h=l.abortReason,i=i.concat(me(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=yu)u=!0,h="maxretry",i=i.concat(me(n.serverSyncTree_,l.currentWriteId,!0));else{const d=ei(n,l.path,o);l.currentInputSnapshot=d;const p=e[a].update(d.val());if(p!==void 0){kt("transaction failed: Data returned ",p,l.path);let _=x(p);typeof p=="object"&&p!=null&&q(p,".priority")||(_=_.updatePriority(d.getPriority()));const P=l.currentWriteId,ae=Ot(n),le=qs(_,d,ae);l.currentOutputSnapshotRaw=_,l.currentOutputSnapshotResolved=le,l.currentWriteId=bn(n),o.splice(o.indexOf(P),1),i=i.concat(Hs(n.serverSyncTree_,l.path,le,l.currentWriteId,l.applyLocally)),i=i.concat(me(n.serverSyncTree_,P,!0))}else u=!0,h="nodata",i=i.concat(me(n.serverSyncTree_,l.currentWriteId,!0))}Q(n.eventQueue_,t,i),i=[],u&&(e[a].status=2,(function(d){setTimeout(d,Math.floor(0))})(e[a].unwatcher),e[a].onComplete&&(h==="nodata"?s.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):s.push(()=>e[a].onComplete(new Error(h),!1,null))))}Sn(n,n.transactionQueueTree_);for(let a=0;a<s.length;a++)tt(s[a]);En(n,n.transactionQueueTree_)}function Do(n,e){let t,s=n.transactionQueueTree_;for(t=y(e);t!==null&&Ue(s)===void 0;)s=yn(s,t),e=I(e),t=y(e);return s}function Oo(n,e){const t=[];return Mo(n,e,t),t.sort((s,i)=>s.order-i.order),t}function Mo(n,e,t){const s=Ue(e);if(s)for(let i=0;i<s.length;i++)t.push(s[i]);vn(e,i=>{Mo(n,i,t)})}function Sn(n,e){const t=Ue(e);if(t){let s=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[s]=t[i],s++);t.length=s,Ys(e,t.length>0?t:void 0)}vn(e,s=>{Sn(n,s)})}function ti(n,e){const t=Pt(Do(n,e)),s=yn(n.transactionQueueTree_,e);return cu(s,i=>{Hn(n,i)}),Hn(n,s),So(s,i=>{Hn(n,i)}),t}function Hn(n,e){const t=Ue(e);if(t){const s=[];let i=[],r=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(f(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):(f(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(me(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&s.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?Ys(e,void 0):t.length=r+1,Q(n.eventQueue_,Pt(e),i);for(let o=0;o<s.length;o++)tt(s[o])}}function Du(n){let e="";const t=n.split("/");for(let s=0;s<t.length;s++)if(t[s].length>0){let i=t[s];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function Ou(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const s=t.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):W(`Invalid query segment '${t}' in query '${n}'`)}return e}const cs=function(n,e){const t=Mu(n),s=t.namespace;t.domain==="firebase.com"&&re(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&t.domain!=="localhost"&&re("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||zl();const i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new Ur(t.host,t.secure,s,i,e,"",s!==t.subdomain),path:new E(t.pathString)}},Mu=function(n){let e="",t="",s="",i="",r="",o=!0,a="https",l=443;if(typeof n=="string"){let c=n.indexOf("//");c>=0&&(a=n.substring(0,c-1),n=n.substring(c+2));let u=n.indexOf("/");u===-1&&(u=n.length);let h=n.indexOf("?");h===-1&&(h=n.length),e=n.substring(0,Math.min(u,h)),u<h&&(i=Du(n.substring(u,h)));const d=Ou(n.substring(Math.min(n.length,h)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;const p=e.slice(0,c);if(p.toLowerCase()==="localhost")t="localhost";else if(p.split(".").length<=2)t=p;else{const _=e.indexOf(".");s=e.substring(0,_).toLowerCase(),t=e.substring(_+1),r=s}"ns"in d&&(r=d.ns)}return{host:e,port:l,domain:t,subdomain:s,secure:o,scheme:a,pathString:i,namespace:r}};const Yi="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Lu=(function(){let n=0;const e=[];return function(t){const s=t===n;n=t;let i;const r=new Array(8);for(i=7;i>=0;i--)r[i]=Yi.charAt(t%64),t=Math.floor(t/64);f(t===0,"Cannot push at time == 0");let o=r.join("");if(s){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=Yi.charAt(e[i]);return f(o.length===20,"nextPushId: Length should be 20."),o}})();class Lo{constructor(e,t,s,i){this.eventType=e,this.eventRegistration=t,this.snapshot=s,this.prevName=i}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+k(this.snapshot.exportVal())}}class Fo{constructor(e,t,s){this.eventRegistration=e,this.error=t,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class ni{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return f(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}let Fu=class{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new H;return Iu(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){X("OnDisconnect.remove",this._path);const e=new H;return Ki(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){X("OnDisconnect.set",this._path),oe("OnDisconnect.set",e,this._path,!1);const t=new H;return Ki(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){X("OnDisconnect.setWithPriority",this._path),oe("OnDisconnect.setWithPriority",e,this._path,!1),Js("OnDisconnect.setWithPriority",t);const s=new H;return Tu(this._repo,this._path,e,t,s.wrapCallback(()=>{})),s.promise}update(e){X("OnDisconnect.update",this._path),To("OnDisconnect.update",e,this._path);const t=new H;return Nu(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};class z{constructor(e,t,s,i){this._repo=e,this._path=t,this._queryParams=s,this._orderByCalled=i}get key(){return v(this._path)?null:Ns(this._path)}get ref(){return new Z(this._repo,this._path)}get _queryIdentifier(){const e=Mi(this._queryParams),t=Es(e);return t==="{}"?"default":t}get _queryObject(){return Mi(this._queryParams)}isEqual(e){if(e=K(e),!(e instanceof z))return!1;const t=this._repo===e._repo,s=Rs(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&s&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+Nc(this._path)}}function In(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Re(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===ie){const s="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Ee)throw new Error(s);if(typeof e!="string")throw new Error(i)}if(n.hasEnd()){if(n.getIndexEndName()!==pe)throw new Error(s);if(typeof t!="string")throw new Error(i)}}else if(n.getIndex()===N){if(e!=null&&!St(e)||t!=null&&!St(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(f(n.getIndex()instanceof Ps||n.getIndex()===ks,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Tn(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class Z extends z{constructor(e,t){super(e,t,new un,!1)}get parent(){const e=Kr(this._path);return e===null?null:new Z(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}let Nn=class hs{constructor(e,t,s){this._node=e,this.ref=t,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new E(e),s=Fe(this.ref,e);return new hs(this._node.getChild(t),s,N)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(s,i)=>e(new hs(i,Fe(this.ref,s),N)))}hasChild(e){const t=new E(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function Bo(n,e){return n=K(n),n._checkNotDeleted("ref"),e!==void 0?Fe(n._root,e):n._root}function Ji(n,e){n=K(n),n._checkNotDeleted("refFromURL");const t=cs(e,n._repo.repoInfo_.nodeAdmin);No("refFromURL",t);const s=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&s.host!==n._repo.repoInfo_.host&&re("refFromURL: Host name does not match the current database: (found "+s.host+" but expected "+n._repo.repoInfo_.host+")"),Bo(n,t.path.toString())}function Fe(n,e){return n=K(n),y(n._path)===null?_u("child","path",e):It("child","path",e),new Z(n._repo,R(n._path,e))}function Bu(n,e){n=K(n),X("push",n._path),oe("push",e,n._path,!0);const t=Po(n._repo),s=Lu(t),i=Fe(n,s),r=Fe(n,s);let o;return e!=null?o=si(r,e).then(()=>r):o=Promise.resolve(r),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function Wu(n){return X("remove",n._path),si(n,null)}function si(n,e){n=K(n),X("set",n._path),oe("set",e,n._path,!1);const t=new H;return Zs(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function Uu(n,e){n=K(n),X("setPriority",n._path),Js("setPriority",e);const t=new H;return Zs(n._repo,R(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function Hu(n,e,t){if(X("setWithPriority",n._path),oe("setWithPriority",e,n._path,!1),Js("setWithPriority",t),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";const s=new H;return Zs(n._repo,n._path,e,t,s.wrapCallback(()=>{})),s.promise}function Vu(n,e){To("update",e,n._path);const t=new H;return Eu(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function $u(n){n=K(n);const e=new ni(()=>{}),t=new Mt(e);return bu(n._repo,n,t).then(s=>new Nn(s,new Z(n._repo,n._path),n._queryParams.getIndex()))}class Mt{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const s=t._queryParams.getIndex();return new Lo("value",this,new Nn(e.snapshotNode,new Z(t._repo,t._path),s))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Fo(this,e,t):null}matches(e){return e instanceof Mt?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class Rn{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Fo(this,e,t):null}createEvent(e,t){f(e.childName!=null,"Child events should have a childName.");const s=Fe(new Z(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new Lo(e.type,this,new Nn(e.snapshotNode,s,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Rn?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function Lt(n,e,t,s,i){let r;if(typeof s=="object"&&(r=void 0,i=s),typeof s=="function"&&(r=s),i&&i.onlyOnce){const l=t,c=(u,h)=>{ls(n._repo,n,a),l(u,h)};c.userCallback=t.userCallback,c.context=t.context,t=c}const o=new ni(t,r||void 0),a=e==="value"?new Mt(o):new Rn(e,o);return Ru(n._repo,n,a),()=>ls(n._repo,n,a)}function us(n,e,t,s){return Lt(n,"value",e,t,s)}function Xi(n,e,t,s){return Lt(n,"child_added",e,t,s)}function Zi(n,e,t,s){return Lt(n,"child_changed",e,t,s)}function er(n,e,t,s){return Lt(n,"child_moved",e,t,s)}function tr(n,e,t,s){return Lt(n,"child_removed",e,t,s)}function nr(n,e,t){let s=null;const i=t?new ni(t):null;e==="value"?s=new Mt(i):e&&(s=new Rn(e,i)),ls(n._repo,n,s)}class se{}class Wo extends se{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){oe("endAt",this._value,e._path,!0);const t=Xn(e._queryParams,this._value,this._key);if(Tn(t),Re(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new z(e._repo,e._path,t,e._orderByCalled)}}function zu(n,e){return Dt("endAt","key",e),new Wo(n,e)}class ju extends se{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){oe("endBefore",this._value,e._path,!1);const t=Zc(e._queryParams,this._value,this._key);if(Tn(t),Re(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new z(e._repo,e._path,t,e._orderByCalled)}}function Gu(n,e){return Dt("endBefore","key",e),new ju(n,e)}class Uo extends se{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){oe("startAt",this._value,e._path,!0);const t=Jn(e._queryParams,this._value,this._key);if(Tn(t),Re(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new z(e._repo,e._path,t,e._orderByCalled)}}function qu(n=null,e){return Dt("startAt","key",e),new Uo(n,e)}class Qu extends se{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){oe("startAfter",this._value,e._path,!1);const t=Xc(e._queryParams,this._value,this._key);if(Tn(t),Re(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new z(e._repo,e._path,t,e._orderByCalled)}}function Ku(n,e){return Dt("startAfter","key",e),new Qu(n,e)}class Yu extends se{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new z(e._repo,e._path,Yc(e._queryParams,this._limit),e._orderByCalled)}}function Ju(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Yu(n)}class Xu extends se{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new z(e._repo,e._path,Jc(e._queryParams,this._limit),e._orderByCalled)}}function Zu(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Xu(n)}class ed extends se{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){In(e,"orderByChild");const t=new E(this._path);if(v(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const s=new Ps(t),i=dn(e._queryParams,s);return Re(i),new z(e._repo,e._path,i,!0)}}function td(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return It("orderByChild","path",n),new ed(n)}class nd extends se{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){In(e,"orderByKey");const t=dn(e._queryParams,ie);return Re(t),new z(e._repo,e._path,t,!0)}}function sd(){return new nd}class id extends se{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){In(e,"orderByPriority");const t=dn(e._queryParams,N);return Re(t),new z(e._repo,e._path,t,!0)}}function rd(){return new id}class od extends se{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){In(e,"orderByValue");const t=dn(e._queryParams,ks);return Re(t),new z(e._repo,e._path,t,!0)}}function ad(){return new od}class ld extends se{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(oe("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Wo(this._value,this._key)._apply(new Uo(this._value,this._key)._apply(e))}}function cd(n,e){return Dt("equalTo","key",e),new ld(n,e)}function ee(n,...e){let t=K(n);for(const s of e)t=s._apply(t);return t}Hh(Z);Gh(Z);const hd="FIREBASE_DATABASE_EMULATOR_HOST",ds={};let ud=!1;function dd(n,e,t,s){const i=e.lastIndexOf(":"),r=e.substring(0,i),o=_s(r);n.repoInfo_=new Ur(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),s&&(n.authTokenProvider_=s)}function Ho(n,e,t,s,i){let r=s||n.options.databaseURL;r===void 0&&(n.options.projectId||re("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),L("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=cs(r,i),a=o.repoInfo,l,c;typeof process<"u"&&gi&&(c=gi[hd]),c?(l=!0,r=`http://${c}?ns=${a.namespace}`,o=cs(r,i),a=o.repoInfo):l=!o.repoInfo.secure;const u=i&&l?new ze(ze.OWNER):new tc(n.name,n.options,e);No("Invalid Firebase Database URL",o),v(o.path)||re("Database URL must point to the root of a Firebase Database (not including a child path).");const h=pd(a,n,u,new ec(n,t));return new _d(h,n)}function fd(n,e){const t=ds[e];(!t||t[n.key]!==n)&&re(`Database ${e}(${n.repoInfo_}) has already been deleted.`),ko(n),delete t[n.key]}function pd(n,e,t,s){let i=ds[e.name];i||(i={},ds[e.name]=i);let r=i[n.toURLString()];return r&&re("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new vu(n,ud,t,s),i[n.toURLString()]=r,r}let _d=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(wu(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Z(this._repo,b())),this._rootInternal}_delete(){return this._rootInternal!==null&&(fd(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&re("Cannot call "+e+" on a deleted database.")}};function Vo(){Qe.IS_TRANSPORT_INITIALIZED&&W("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function md(){Vo(),_e.forceDisallow()}function gd(){Vo(),Y.forceDisallow(),_e.forceAllow()}function yd(n,e,t,s={}){n=K(n),n._checkNotDeleted("useEmulator");const i=`${e}:${t}`,r=n._repoInternal;if(n._instanceStarted){if(i===n._repoInternal.repoInfo_.host&&$t(s,r.repoInfo_.emulatorOptions))return;re("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(r.repoInfo_.nodeAdmin)s.mockUserToken&&re('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new ze(ze.OWNER);else if(s.mockUserToken){const a=typeof s.mockUserToken=="string"?s.mockUserToken:ea(s.mockUserToken,n.app.options.projectId);o=new ze(a)}_s(e)&&(Zo(e),sa("Database",!0)),dd(r,i,s,o)}function vd(n){n=K(n),n._checkNotDeleted("goOffline"),ko(n._repo)}function wd(n){n=K(n),n._checkNotDeleted("goOnline"),xu(n._repo)}function Cd(n,e){Rr(n,e)}function bd(n){Sr(ws),qe(new de("database",(e,{instanceIdentifier:t})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return Ho(s,i,r,t)},"PUBLIC").setMultipleInstances(!0)),he(yi,vi,n),he(yi,vi,"esm2020")}const Ed={".sv":"timestamp"};function Sd(){return Ed}function Id(n){return{".sv":{increment:n}}}let Td=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function Nd(n,e,t){if(n=K(n),X("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";const s=t?.applyLocally??!0,i=new H,r=(a,l,c)=>{let u=null;a?i.reject(a):(u=new Nn(c,new Z(n._repo,n._path),N),i.resolve(new Td(l,u)))},o=us(n,()=>{});return Au(n._repo,n._path,e,r,o,s),i.promise}ue.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};ue.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};bd();const Rd="@firebase/database-compat",xd="2.1.0";const Ad=new an("@firebase/database-compat"),$o=function(n){const e="FIREBASE WARNING: "+n;Ad.warn(e)};const Pd=function(n,e,t,s){if(t!==void 0&&typeof t!="boolean")throw new Error($(n,e)+"must be a boolean.")},kd=function(n,e,t){if(e!==void 0)switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error($(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};class Dd{constructor(e){this._delegate=e}cancel(e){g("OnDisconnect.cancel",0,1,arguments.length),O("OnDisconnect.cancel","onComplete",e,!0);const t=this._delegate.cancel();return e&&t.then(()=>e(null),s=>e(s)),t}remove(e){g("OnDisconnect.remove",0,1,arguments.length),O("OnDisconnect.remove","onComplete",e,!0);const t=this._delegate.remove();return e&&t.then(()=>e(null),s=>e(s)),t}set(e,t){g("OnDisconnect.set",1,2,arguments.length),O("OnDisconnect.set","onComplete",t,!0);const s=this._delegate.set(e);return t&&s.then(()=>t(null),i=>t(i)),s}setWithPriority(e,t,s){g("OnDisconnect.setWithPriority",2,3,arguments.length),O("OnDisconnect.setWithPriority","onComplete",s,!0);const i=this._delegate.setWithPriority(e,t);return s&&i.then(()=>s(null),r=>s(r)),i}update(e,t){if(g("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){const i={};for(let r=0;r<e.length;++r)i[""+r]=e[r];e=i,$o("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}O("OnDisconnect.update","onComplete",t,!0);const s=this._delegate.update(e);return t&&s.then(()=>t(null),i=>t(i)),s}}class Od{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return g("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class we{constructor(e,t){this._database=e,this._delegate=t}val(){return g("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return g("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return g("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return g("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return g("DataSnapshot.child",0,1,arguments.length),e=String(e),It("DataSnapshot.child","path",e),new we(this._database,this._delegate.child(e))}hasChild(e){return g("DataSnapshot.hasChild",1,1,arguments.length),It("DataSnapshot.hasChild","path",e),this._delegate.hasChild(e)}getPriority(){return g("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return g("DataSnapshot.forEach",1,1,arguments.length),O("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new we(this._database,t)))}hasChildren(){return g("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return g("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return g("DataSnapshot.ref",0,0,arguments.length),new j(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class B{constructor(e,t){this.database=e,this._delegate=t}on(e,t,s,i){g("Query.on",2,4,arguments.length),O("Query.on","callback",t,!1);const r=B.getCancelAndContextArgs_("Query.on",s,i),o=(l,c)=>{t.call(r.context,new we(this.database,l),c)};o.userCallback=t,o.context=r.context;const a=r.cancel?.bind(r.context);switch(e){case"value":return us(this._delegate,o,a),t;case"child_added":return Xi(this._delegate,o,a),t;case"child_removed":return tr(this._delegate,o,a),t;case"child_changed":return Zi(this._delegate,o,a),t;case"child_moved":return er(this._delegate,o,a),t;default:throw new Error($("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,s){if(g("Query.off",0,3,arguments.length),kd("Query.off",e),O("Query.off","callback",t,!0),ai("Query.off","context",s),t){const i=()=>{};i.userCallback=t,i.context=s,nr(this._delegate,e,i)}else nr(this._delegate,e)}get(){return $u(this._delegate).then(e=>new we(this.database,e))}once(e,t,s,i){g("Query.once",1,4,arguments.length),O("Query.once","callback",t,!0);const r=B.getCancelAndContextArgs_("Query.once",s,i),o=new H,a=(c,u)=>{const h=new we(this.database,c);t&&t.call(r.context,h,u),o.resolve(h)};a.userCallback=t,a.context=r.context;const l=c=>{r.cancel&&r.cancel.call(r.context,c),o.reject(c)};switch(e){case"value":us(this._delegate,a,l,{onlyOnce:!0});break;case"child_added":Xi(this._delegate,a,l,{onlyOnce:!0});break;case"child_removed":tr(this._delegate,a,l,{onlyOnce:!0});break;case"child_changed":Zi(this._delegate,a,l,{onlyOnce:!0});break;case"child_moved":er(this._delegate,a,l,{onlyOnce:!0});break;default:throw new Error($("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return g("Query.limitToFirst",1,1,arguments.length),new B(this.database,ee(this._delegate,Ju(e)))}limitToLast(e){return g("Query.limitToLast",1,1,arguments.length),new B(this.database,ee(this._delegate,Zu(e)))}orderByChild(e){return g("Query.orderByChild",1,1,arguments.length),new B(this.database,ee(this._delegate,td(e)))}orderByKey(){return g("Query.orderByKey",0,0,arguments.length),new B(this.database,ee(this._delegate,sd()))}orderByPriority(){return g("Query.orderByPriority",0,0,arguments.length),new B(this.database,ee(this._delegate,rd()))}orderByValue(){return g("Query.orderByValue",0,0,arguments.length),new B(this.database,ee(this._delegate,ad()))}startAt(e=null,t){return g("Query.startAt",0,2,arguments.length),new B(this.database,ee(this._delegate,qu(e,t)))}startAfter(e=null,t){return g("Query.startAfter",0,2,arguments.length),new B(this.database,ee(this._delegate,Ku(e,t)))}endAt(e=null,t){return g("Query.endAt",0,2,arguments.length),new B(this.database,ee(this._delegate,zu(e,t)))}endBefore(e=null,t){return g("Query.endBefore",0,2,arguments.length),new B(this.database,ee(this._delegate,Gu(e,t)))}equalTo(e,t){return g("Query.equalTo",1,2,arguments.length),new B(this.database,ee(this._delegate,cd(e,t)))}toString(){return g("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return g("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(g("Query.isEqual",1,1,arguments.length),!(e instanceof B)){const t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,s){const i={cancel:void 0,context:void 0};if(t&&s)i.cancel=t,O(e,"cancel",i.cancel,!0),i.context=s,ai(e,"context",i.context);else if(t)if(typeof t=="object"&&t!==null)i.context=t;else if(typeof t=="function")i.cancel=t;else throw new Error($(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return i}get ref(){return new j(this.database,new Z(this._delegate._repo,this._delegate._path))}}class j extends B{constructor(e,t){super(e,new z(t._repo,t._path,new un,!1)),this.database=e,this._delegate=t}getKey(){return g("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return g("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new j(this.database,Fe(this._delegate,e))}getParent(){g("Reference.parent",0,0,arguments.length);const e=this._delegate.parent;return e?new j(this.database,e):null}getRoot(){return g("Reference.root",0,0,arguments.length),new j(this.database,this._delegate.root)}set(e,t){g("Reference.set",1,2,arguments.length),O("Reference.set","onComplete",t,!0);const s=si(this._delegate,e);return t&&s.then(()=>t(null),i=>t(i)),s}update(e,t){if(g("Reference.update",1,2,arguments.length),Array.isArray(e)){const i={};for(let r=0;r<e.length;++r)i[""+r]=e[r];e=i,$o("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}X("Reference.update",this._delegate._path),O("Reference.update","onComplete",t,!0);const s=Vu(this._delegate,e);return t&&s.then(()=>t(null),i=>t(i)),s}setWithPriority(e,t,s){g("Reference.setWithPriority",2,3,arguments.length),O("Reference.setWithPriority","onComplete",s,!0);const i=Hu(this._delegate,e,t);return s&&i.then(()=>s(null),r=>s(r)),i}remove(e){g("Reference.remove",0,1,arguments.length),O("Reference.remove","onComplete",e,!0);const t=Wu(this._delegate);return e&&t.then(()=>e(null),s=>e(s)),t}transaction(e,t,s){g("Reference.transaction",1,3,arguments.length),O("Reference.transaction","transactionUpdate",e,!1),O("Reference.transaction","onComplete",t,!0),Pd("Reference.transaction","applyLocally",s);const i=Nd(this._delegate,e,{applyLocally:s}).then(r=>new Od(r.committed,new we(this.database,r.snapshot)));return t&&i.then(r=>t(null,r.committed,r.snapshot),r=>t(r,!1,null)),i}setPriority(e,t){g("Reference.setPriority",1,2,arguments.length),O("Reference.setPriority","onComplete",t,!0);const s=Uu(this._delegate,e);return t&&s.then(()=>t(null),i=>t(i)),s}push(e,t){g("Reference.push",0,2,arguments.length),O("Reference.push","onComplete",t,!0);const s=Bu(this._delegate,e),i=s.then(o=>new j(this.database,o));t&&i.then(()=>t(null),o=>t(o));const r=new j(this.database,s);return r.then=i.then.bind(i),r.catch=i.catch.bind(i,void 0),r}onDisconnect(){return X("Reference.onDisconnect",this._delegate._path),new Dd(new Fu(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class Tt{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:md,forceLongPolling:gd}}useEmulator(e,t,s={}){yd(this._delegate,e,t,s)}ref(e){if(g("database.ref",0,1,arguments.length),e instanceof j){const t=Ji(this._delegate,e.toString());return new j(this,t)}else{const t=Bo(this._delegate,e);return new j(this,t)}}refFromURL(e){g("database.refFromURL",1,1,arguments.length);const s=Ji(this._delegate,e);return new j(this,s)}goOffline(){return g("database.goOffline",0,0,arguments.length),vd(this._delegate)}goOnline(){return g("database.goOnline",0,0,arguments.length),wd(this._delegate)}}Tt.ServerValue={TIMESTAMP:Sd(),increment:n=>Id(n)};function Md({app:n,url:e,version:t,customAuthImpl:s,customAppCheckImpl:i,namespace:r,nodeAdmin:o=!1}){Sr(t);const a=new ms("database-standalone"),l=new $n("auth-internal",a);l.setComponent(new de("auth-internal",()=>s,"PRIVATE"));let c;return i&&(c=new $n("app-check-internal",a),c.setComponent(new de("app-check-internal",()=>i,"PRIVATE"))),{instance:new Tt(Ho(n,l,c,e,o),n),namespace:r}}var Ld=Object.freeze({__proto__:null,initStandalone:Md});const Fd=Tt.ServerValue;function Bd(n){n.INTERNAL.registerComponent(new de("database-compat",(e,{instanceIdentifier:t})=>{const s=e.getProvider("app-compat").getImmediate(),i=e.getProvider("database").getImmediate({identifier:t});return new Tt(i,s)},"PUBLIC").setServiceProps({Reference:j,Query:B,Database:Tt,DataSnapshot:we,enableLogging:Cd,INTERNAL:Ld,ServerValue:Fd}).setMultipleInstances(!0)),n.registerVersion(Rd,xd)}Bd(ln);const Wd={apiKey:"AIzaSyCFEMNjjx75Q3E9KcnLNnwHyjNfsGll1QA",authDomain:"gameppt-5a53e.firebaseapp.com",databaseURL:"https://gameppt-5a53e-default-rtdb.firebaseio.com",projectId:"gameppt-5a53e",storageBucket:"gameppt-5a53e.firebasestorage.app",messagingSenderId:"436392226432",appId:"1:436392226432:web:190c78b73aa2d32d520065",measurementId:"G-CQBG1NRXN7"};ln.initializeApp(Wd);const Ve=ln.database(),Wt="",A={data:{name:"",userId:"",roomId:"",rtdbRoomId:"",online:!1,move:"",rtdbData:{},score:{wins:0,lose:0,draw:0}},listeners:[],init(){const n=localStorage.getItem("gameState");if(n){const e=JSON.parse(n);e.move="",this.setState(e)}},getState(){return this.data},setState(n){this.data={...this.data,...n};for(const e of this.listeners)e();console.log("soy el state, he cambiado: ",this.data),localStorage.setItem("gameState",JSON.stringify(this.data))},subscribe(n){this.listeners.push(n)},setName(n){if(n)return fetch(Wt+"/player",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n})}).then(e=>e.json()).then(e=>{this.setState({name:n,userId:e.id})})},askNewRoom(n){const e=this.getState();if(e.userId)return fetch(Wt+"/gamerooms",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.userId})}).then(t=>t.json()).then(t=>(this.setState({roomId:t.id,rtdbRoomId:t.rtdbRoomId}),n&&n(),t))},accessToRoom(n){const e=this.getState(),t=e.userId;return n&&t?(console.log("Fetcheando:",Wt+"/gamerooms/"+n+"?userId="+t),fetch(Wt+"/gamerooms/"+n+"?userId="+t).then(s=>{if(!s.ok)throw new Error("Room not found");return s.json()}).then(s=>{console.log("Data recibida del server:",s),e.roomId=n,e.rtdbRoomId=s.rtdbRoomId,this.setState(e),this.listenRoom()})):(console.error("No hay roomId o userId"),Promise.reject("Faltan datos"))},setMove(n){const e=this.getState();e.move=n,this.setState(e),Ve.ref("/rooms/"+e.rtdbRoomId+"/online/"+e.userId).update({choice:n}),console.log("jugada enviada:",n)},listenRoom(){const n=this.getState();console.log("Escuchando la sala:",n.rtdbRoomId);const e=Ve.ref("/rooms/"+n.rtdbRoomId+"/online/"+n.userId);e.set({online:!0,name:n.name}),e.onDisconnect().set(!1),Ve.ref("/rooms/"+n.rtdbRoomId).on("value",s=>{const i=s.val();if(!i)return;const r=this.getState();console.log("Sala actualizada:",i);const o={rtdbData:i};i.online&&i.online[r.userId]&&(o.online=!0),this.setState(o)})},setStart(n){const e=this.getState();console.log("SET START llamado con:",n),console.log("IDs:",e.rtdbRoomId,e.userId),Ve.ref("/rooms/"+e.rtdbRoomId+"/online/"+e.userId).update({start:n}).then(()=>{console.log("Start actualizado con xito")}).catch(s=>{console.error("Error al actualizar start:",s)})},whoWon(n,e){return[{myMove:"piedra",opponentMove:"tijera"},{myMove:"papel",opponentMove:"piedra"},{myMove:"tijera",opponentMove:"papel"}].find(i=>i.myMove===n&&i.opponentMove===e)?"wins":n===e?"draw":"lose"},restart(){const n=this.getState();Ve.ref("/rooms/"+n.rtdbRoomId+"/online/"+n.userId).update({start:!1,choice:""})},updateScore(n){const e=this.getState(),t=e.score;t[n]=t[n]+1,Ve.ref("/rooms/"+e.rtdbRoomId+"/online/"+e.userId).update({score:t}),e.score=t,this.setState(e)}};function Ud(){const n=document.createElement("div");return n.innerHTML=`
   <style> 
          .welcome__container{
          display: flex;
          flex-direction: column;
          justify-content: center; /* Opcional: para centrar el ttulo si el contenedor es ms ancho */
          align-items: center;
          margin: 115px 0 0 0;
          }

          .welcome__container-btn{
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          }
   </style>
   <div class = "welcome__container">
        <my-title></my-title>
        <div class ="welcome__container-btn">
          <my-button id="new-game" class="blue" destino="new-game">Nuevo Juego</my-button>
          <my-button id="sala" class="blue" destino="sala">Ingresar a una sala</my-button>
        </div>
   </div>
   `,n.querySelector("#new-game").addEventListener("navigate",s=>{const i=s.detail.to,r=i.startsWith("/")?i:"/"+i,o=new CustomEvent("route",{detail:{route:r}});window.dispatchEvent(o)}),n.querySelector("#sala ").addEventListener("click",()=>{const s=new CustomEvent("route",{detail:{route:"/sala"}});window.dispatchEvent(s)}),n}function Hd(){const n=document.createElement("div");return n.innerHTML=`
      <style> 
          .welcome__container{
          display: flex;
          flex-direction: column;
          justify-content: center; /* Opcional: para centrar el ttulo si el contenedor es ms ancho */
          align-items: center;
          margin: 115px 0 0 0;
          }

          .form{
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          }
   </style>
        <div class = "welcome__container">
        <my-title></my-title>
        <div class ="form">
            <my-input></my-input>
            <my-button class="blue" destino="game">Nombre</my-button>
        </div>
      </div>
    `,n.querySelector("my-button").addEventListener("click",t=>{t.preventDefault();const i=n.querySelector("my-input").value;A.setName(i)?.then(()=>A.askNewRoom()).then(r=>A.accessToRoom(r.id)).then(()=>{const r=new CustomEvent("route",{detail:{route:"/wait"}});window.dispatchEvent(r)})}),n}function Vd(){const n=document.createElement("div");return n.innerHTML=`
      <style> 
          .welcome__container{
          display: flex;
          flex-direction: column;
          justify-content: center; /* Opcional: para centrar el ttulo si el contenedor es ms ancho */
          align-items: center;
          margin: 115px 0 0 0;
          }

          .welcome__container-btn{
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          }
   </style>
   
        <div class = "welcome__container">
            <my-title></my-title>
            <div class ="welcome__container-btn">
                <my-input></my-input>
                <my-button class="blue" destino="rules">ingresar a una sala</my-button>
            </div>
        </div>
    `,n}function $d(){const n=document.createElement("div");A.getState().userId||setTimeout(()=>{const i=new CustomEvent("route",{detail:{route:"/"}});window.dispatchEvent(i),alert("Por favor, inicia sesin primero.")},0),n.innerHTML=`
    <style>
    .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
    }
    .title {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }
    .aviso {
        width: 350px;
        text-align: center;
        font-size: 22px;
        font-weight: bold;
        margin-bottom: 20px;
        color: red;
        background-color: #f0f0f0da;
        padding: 10px;
        border-radius: 5px;
        display: none;
    }
    .username { 
        font-weight: bold; margin-top: 10px; 
    }
    .username-online { color: #28a745; 
    }  
    </style>
    <div class="container">
        <p class = "aviso">Esa sala no existe</p>
        <p id = "username" class = "username"></p>
        <my-title></my-title>
        <my-input></my-input>
        <my-button class = "blue" id = "join">Unirse a una sala</my-button>
    </div>
    `;const t=n.querySelector("#username");return A.subscribe(()=>{const i=A.getState();t.textContent=i.name||"",i.online?t.classList.add("username-online"):t.classList.remove("username-online")}),n.querySelector("#join").addEventListener("click",()=>{const r=n.querySelector("my-input").value;console.log(r);const o=A.getState();console.log("Intentando acceder a sala:",r,"con userId:",o.userId),A.accessToRoom(r)?.then(()=>{const a=new CustomEvent("route",{detail:{route:"/wait"}});window.dispatchEvent(a)}).catch(a=>{console.error("Error al acceder a la sala:",a);const l=n.querySelector(".aviso");l.style.display="block"})}),n}function zd(){const n=document.createElement("div"),e=new URL("/assets/piedra-DuFYeu0w.svg",import.meta.url).href,t=new URL("/assets/papel-BxPnimu3.svg",import.meta.url).href,s=new URL("/assets/tijera-D13S6w_M.svg",import.meta.url).href,i=A.getState();n.className="play-page",n.innerHTML=`
    <style>
    .play-page{
        height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: start;
        padding-top: 40px;
        row-gap: 150px;
    }
    .hands-title{
        margin: 0;
        color: #000;
        font-family: var(--font);
        font-size: 60px;
        font-weight: 700;
    }

    .hands-container{
        display: flex;
        column-gap: 50px;
    }
    .play-text{
        opacity: 0;
    }
    .hand-img{
        width: 100px; 
        height: auto;
    }
    .hand-img:hover{
        transform: translateY(-10px);
        filter: drop-shadow(
            0 0 15px rgba(17, 54, 141, 0.96)
        )
    }
    .container-hand-paper{
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        row-gap: 15px;
    }
    .container-hand-paper:hover .play-text{
        color:#fff;
        opacity: 1;
        font-size: 22px;
        font-family: var(--font);
        font-weight: 700;
    }
    .play-page__header{
        width: 100%;
        display: flex;
        flex-direction: column;
        color: #000;
        }
        .play-page__header h2{
            margin: 5px 20px;
            font-family: var(--font);
            font-size: 22px;
            font-weight: 700;
    }

    </style>

    <div class ="play-page__header">
        <h2>Sala: ${i.roomId}</h2>
        <h2>Usuario: ${i.name}</h2>
    </div>
      <div class="play-page__content">
            <!-- El contador se mostrar aqu cuando el usuario elija una mano -->
        </div>
        <p class ="hands-title"> Elige una opcin</p>
        <div class="hands-container">

             <!--contenedor de piedra-->
            <div class = "container-hand-paper">
            <img src="${e}" class="hand-img" data-move="piedra" alt="Piedra">
            <span class ="play-text">Piedra</span>
            </div>

             <!--contenedor de papel-->
            <div class = "container-hand-paper">
            <img src="${t}" class="hand-img" data-move="papel" alt="Papel">
            <span class ="play-text">Papel</span>
            </div>
            
            <!--contenedor de tijera-->
            <div class = "container-hand-paper">
            <img src="${s}" class="hand-img" data-move="tijera" alt="Tijera">
            <span class ="play-text">Tijera</span>
            </div>
        </div>
   

    `;const r=n.querySelectorAll(".hand-img"),o=n.querySelector(".hands-container"),a=n.querySelector(".hands-title"),l=n.querySelector(".play-page__content");return r.forEach(c=>{c.addEventListener("click",u=>{const d=u.target.dataset.move;A.setMove(d),o.style.display="none",a.textContent="Esperando al oponente..."})}),A.subscribe(()=>{if(!document.body.contains(n))return;const u=A.getState().rtdbData;if(u&&u.online&&u.playerOne&&u.playerTwo){const h=u.online[u.playerOne],d=u.online[u.playerTwo];if(h&&h.choice&&d&&d.choice&&l?.children.length===0){a.style.display="none";const p=document.createElement("my-contador");l?.appendChild(p),p.addEventListener("countdown-finished",()=>{const _=new CustomEvent("route",{detail:{route:"/result"}});window.dispatchEvent(_)})}}}),n}function jd(){const n=document.createElement("div"),e=A.getState(),t=e.rtdbData;let s=e.move,i="";e.userId==t.playerOne&&t.playerTwo?i=t.online[t.playerTwo].choice:e.userId==t.playerTwo&&t.playerOne&&(i=t.online[t.playerOne].choice);const r=A.whoWon(s,i);A.updateScore(r);const a=A.getState().score;let l="",c="";return r==="wins"?(l="rgba(136, 233, 168, 0.9)",c="Ganaste"):r==="lose"?(l="rgba(137, 73, 73, 0.9)",c="Perdiste"):(l="rgba(255, 233, 157, 0.9)",c="Empate"),n.innerHTML=`
        <style>
            .result-page {
                height: 100vh;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                background-color: ${l};
            }
            .result-title {
                font-size: 80px;
                font-weight: bold;
                margin-bottom: 20px;
            }
            .score-text {
                font-size: 30px;
                margin-bottom: 40px;
            }
        </style>
        <div class="result-page">
            <h1 class="result-title">${c}</h1>
            <div class="score-text">
                Tu: ${s} <br>
                Oponente: ${i}
            </div>
            <p>
                Ganadas: ${a.wins} | 
                Perdidas: ${a.lose} | 
                Empatadas: ${a.draw}
            </p>
            <my-button>Volver a Jugar</my-button>
        </div>
    `,n.querySelector("my-button")?.addEventListener("click",()=>{A.restart();const h=new CustomEvent("route",{detail:{route:"/wait"}});window.dispatchEvent(h)}),n}function Gd(){const n=document.createElement("div"),e=A.getState(),t=e.score;n.className="wait-page",n.innerHTML=`
    <style>
    .wait-page{
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background-color: #fff;
    }
    .play-page__header{
        width: 100%;
        display: flex;
        flex-direction: column;
        color: #000;
    }
    .play-page__header h2{
        margin: 5px 20px;
        font-family: var(--font);
        font-size: 16px;
        font-weight: 700;
    }
    .wait-play, .wait-player{
        font-family: var(--font);
        font-size: 25px;
        font-weight: 700;
        text-align: center;
    }
    .wait-play{
        display: block;
    }
    .wait-player{
        display: none;
    }
    .play-page__content{
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding-top: 30%;
    }
    .player-one{
        margin-bottom: 5px;
    }
    .opponent{
        margin-bottom: 10px;
    }
    </style>

    <div class ="play-page__header">
        <h2>Sala: ${e.roomId}</h2>
        <p class = "player-one">Player One: ${e.name}</p>
        <p id = "score"> 
            Ganadas: ${t.wins} | 
            Perdidas: ${t.lose} | 
            Empatadas: ${t.draw}
        </p>
        <p id = "opponent" class = "opponent">Esperando oponente...</p>
    </div>
        <div class="play-page__content">
        <div id="wait-play" class = "wait-play">
            <p>Preciona el botn para Jugar y elige: Piedra, Papel o Tijera</p>
            <my-button id="wait-button" class = "blue"> Jugar! </my-button>
        </div>    
        <div id="wait-player" class = "wait-player">
            <p>Esperando a que otro jugador...</p>
        </div>
    </div>
    `;const s=n.querySelector("#wait-button"),i=n.querySelector("#wait-play"),r=n.querySelector("#wait-player");s.addEventListener("click",()=>{i.style.display="none",r.style.display="block",A.setStart(!0)});const o=()=>{const a=n.querySelector("#opponent"),l=A.getState(),c=l.rtdbData;if(c&&Object.keys(c).length>0)if(l.userId==c.playerOne&&c.playerTwo){const u=c.online?c.online[c.playerTwo]:null,h=u&&u.name?u.name:"Player 2";a.textContent=`Oponente: Conectado ${h}`,a.style.color=u&&u.online?"#28a745":"#000"}else if(l.userId==c.playerTwo&&c.playerOne){const u=c.online?c.online[c.playerOne]:null,h=u&&u.name?u.name:"Player 1";a.textContent=`Oponente: Conectado ${h}`,a.style.color=u&&u.online?"#28a745":"#000"}else a.textContent="Esperando oponente...",a.style.color="#000";if(c.playerOne&&c.playerTwo&&c.online){const u=c.online[c.playerOne],h=c.online[c.playerTwo];if(console.log("Player 1:",u),console.log("Player 2:",h),console.log("P1 Start:",u?.start,"P2 Start:",h?.start),u&&u.start&&h&&h.start){const d=new CustomEvent("route",{detail:{route:"/game"}});window.dispatchEvent(d)}}};return A.subscribe(()=>{document.body.contains(n)&&o()}),o(),n}const qd=[{path:"/",component:Ud},{path:"/new-game",component:Hd},{path:"/rooms",component:Vd},{path:"/sala",component:$d},{path:"/game",component:zd},{path:"/result",component:jd},{path:"/wait",component:Gd}];function Qd(n){function e(t){console.log("El router recibi una nueva ruta",t);for(const s of qd)if(s.path===t){const i=s.component();n.firstChild&&n.firstChild.remove(),n.appendChild(i)}}location.pathname=="/"?e("/"):e(location.pathname),window.onpopstate=()=>{e(location.pathname)},window.addEventListener("route",t=>{const s=t.detail.route;window.location.pathname!==s&&history.pushState({},"",s),e(s)})}function Kd(){class n extends HTMLElement{shadow=this.attachShadow({mode:"open"});static get observedAttributes(){return["destino","class"]}constructor(){super()}connectedCallback(){const t=this.getAttribute("class");this.render(t)}render(t){let s=" background: white; border: solid 3px #000; color:#000;",i=`
                 background: #fff ;
                 box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            `;t==="blue"&&(s=`
                    background:#006CFC;
                    border-style:none;
                    color:#fff;
                    transition: background 0.3s ease;
                `,i=`
                background: #0681ff ;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            `),this.shadow.innerHTML=`
                <style>
                    button{
                        ${s}
                        border-radius:10px;
                        width:322px;
                        height:87px;
                        font-family:'Roboto',san serif;
                        font-size:30px;
                        font-weight:400;
                        margin-top:50px;
                        cursor:pointer;
                    }
                    button:hover{
                        ${i}
                    } 
                </style>
                <button><slot></slot></button>
            `;const r=this.shadow.querySelector("button");r&&r.addEventListener("click",this.handleClick.bind(this))}handleClick(){const t=this.getAttribute("destino");if(t){const s=new CustomEvent("navigate",{detail:{to:t}});this.dispatchEvent(s)}}}customElements.define("my-button",n)}function Yd(){class n extends HTMLElement{shadow=this.attachShadow({mode:"open"});constructor(){super()}connectedCallback(){this.render()}render(){this.shadow.innerHTML=`
            <style>
                .welcome__title{
                    color: var(--color-B);
                    margin: 0;
                    font-family: var(--font);
                    text-align: center; /* Centra el texto de cada lnea */
                    font-size: 80px;
                    font-weight: 700;
                    color:  #5f95e7;
                }

                .welcome__title .title-word {
                    display: block; /* Hace que cada span ocupe una lnea nueva */
                }
                .welcome__title .colored {
                    color: var(--color-N); /* Aplica el color oscuro a la palabra "Papel" */
                }
            </style>
            <h1 class ="welcome__title">
                <span class="title-word">Piedra</span>
                <span class="title-word colored">Papel</span>
                <span class="title-word">Tijera</span>
            </h1>
            `}}customElements.define("my-title",n)}function Jd(){class n extends HTMLElement{shadow=this.attachShadow({mode:"open"});constructor(){super()}connectedCallback(){this.render()}get value(){return this.shadow.querySelector("input")?.value}render(){this.shadow.innerHTML=`
            <style>
            .my-input_container{
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                margin: 25px 10px 0 10px;
            }
            .my-input{
                width: 305px;
                height: 70px;
                border: 2px solid #000;
                border-radius: 10px;
            }
            </style>
            <div class="my-input_container">
                <label><slot></slot></label>
                <input class="my-input">
            </div>`}}customElements.define("my-input",n)}function Xd(){class n extends HTMLElement{shadow=this.attachShadow({mode:"open"});constructor(){super()}connectedCallback(){this.render(),this.startCountdown()}startCountdown(){let t=3;const s=setInterval(()=>{const i=this.shadow.querySelector(".countdown-number");i&&(i.textContent=t.toString()),t===0&&(clearInterval(s),this.dispatchEvent(new CustomEvent("countdown-finished",{bubbles:!0,composed:!0}))),t--},1e3)}render(){this.shadow.innerHTML=`
            <style>
                .countdown-container {
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    font-family: var(--font, sans-serif);
                    font-size: 100px;
                    font-weight: bold;
                    color: white; /* Asumiendo tema oscuro */
                }
            </style>
            <div class="countdown-container">
                <span class="countdown-number">Starting...</span>
            </div>
            `}}customElements.define("my-contador",n)}(function(){A.init(),Kd(),Yd(),Jd(),Xd();const n=document.querySelector("#app");n&&Qd(n)})();
